TRUNCATE TABLE EQUITY_DEFN_O_TABLE;
INSERT INTO EQUITY_DEFN_O_TABLE
SELECT 
'' Response,
'' Template,
B.SECID NAME,
CASE WHEN TRIM(B.SECID)LIKE  '%FUND%' or trim(B.SECID)='EQ ALAHLI GULF' THEN 'MF' ELSE 'EQUITY' END INSTRUMENT_TYPE,
CASE WHEN TRIM(B.SECID)LIKE  '%FUND%' or trim(B.SECID)='EQ ALAHLI GULF' THEN 'OPEN ENDED' ELSE 'EQUITY' END INSTRUMENT_SUBTYPE,
trim(C.CMNE) ISSUER_STRING,
CASE 
 WHEN TRIM(B.SECID)LIKE  '%FUND%' or trim(B.SECID)='EQ ALAHLI GULF' THEN 'MUTUAL FUNDS QU'
 WHEN PRODTYPE IN ('E1','T1') THEN 'EQUITY QUOTED' 
 WHEN PRODTYPE = 'E2' THEN 'EQUITY UNQUOTED' 
     END INSTRUMENT_CLASS_DATA_NAME,
'' LISTING_DATE,
B.CCY ISSUE_CCY,
'D'||PRICEDECS PRICE_QUOTE,
'OPEN' ACTIVE_STATUS,
'EPG_KWT' ENTITY_PERM_GROUP,
DESCR DESCRIPTION,
case when trim(B.COST) in  ('2340','2310','0300') then 'KSE' when trim(B.COST)  in  ('2350','2320') then 'UNLISTED' when trim(B.COST)  in  ('2360') then 'NSE' END EXCHANGES_LIST,
case when trim(B.COST)  in  ('2340','2310','0300') then 'KSE' when trim(B.COST)  in  ('2350','2320') then 'UNLISTED' when trim(B.COST)  in  ('2360') then 'NSE' END DEFAULT_EXCHANGE_STR,
'' NO_DELIVERY_START,
'' NO_DELIVERY_END,
DENOM MARKET_LOT,
'' MATURITY_DATE,
'' PAID_UP_VALUE,
PARAMT FACE_VALUE,
CASE WHEN TRIM(B.SECID)LIKE  '%FUND%' or trim(B.SECID)='EQ ALAHLI GULF' THEN '0' end ENTRY_LOAD,
CASE WHEN TRIM(B.SECID)LIKE  '%FUND%' or trim(B.SECID)='EQ ALAHLI GULF' THEN '0' end EXIT_LOAD,
CASE WHEN TRIM(B.SECID)LIKE  '%FUND%' or trim(B.SECID)='EQ ALAHLI GULF' THEN 'MANUAL' end AUTO_OR_MANUAL_RESET,
'NONE' SHORT_SALES_ACTION,
'' MIN_INVEST,
'EQUITY' TRADING_STRATEGY,
'WAP' REALISATION_METHOD,
'SETT DATE' DATE_TO_REALISE,
CASE WHEN TRIM(B.SECID)LIKE  '%FUND%' or trim(B.SECID)='EQ ALAHLI GULF' THEN '1' end INVEST_MULTIPLE,
'' PREBLOCK_PRICE,
'' EQMF_MTM_CALC_METHOD,
'T' IS_DEMAT,
C.UCCODE ISSUANCE_DATA_COI,
'' ISSUANCE_DATA_COUR,
'' INSTRUMENT_ID_$1_IDENTIFIER,
'' INSTRUMENT_ID_$1_CODE,
'' INSTRUMENT_ID_$2_IDENTIFIER,
'' INSTRUMENT_ID_$2_CODE,
'' INSTRUMENT_ID_$3_IDENTIFIER,
'' INSTRUMENT_ID_$3_CODE,
'' ALT_ID1,
'' ALT_ID2,
'' ISSUANCE_DATA_COI_1,
'' ISSUANCE_DATA_COUR_1,
'' RIGHT_WARRANT_DATA_OPTIONALITY,
'' RT_WRNT_DATA_ISSUE_PRICE_STR,
'' RT_WRT_DATA_ISSUE_DISB_QTY,
'' RT_WRT_DATA_ISSUE_BASE_QTY,
'' WRT_DATA_ISS_FRAC_SCPT_TRTMNT,
'' RIGHT_WARRANT_CASH_PAYMNT_DATE,
'' RIGHT_WRT_ACCEPTANCE_CLOSG_DT,
'' RIGHT_WARRANT_DELIVERY_DATE,
'' RIGHT_WRT_TRADING_PERIOD_START,
'' RIGHT_WRT_TRADING_PERIOD_END,
'' RIGHT_WRT_UNRLYNG_EQT_DEFN_NM,
'' RIGHT_WARRANT_OPTION_STYLE,
'' RIGHT_WARRANT_STRIKE_PRICE,
'' RIGHT_WARRANT_OPTION_TYPE,
'' RIGHT_WRT_EXERCISE_DISB_QTY,
'' RIGHT_WRANT_EXERCISE_BASE_QTY,
'' RIGHT_WRANT_EXERISE_START_DATE,
'' RIGHT_WRANT_EXCERCISE_END_DATE,
'' RIGHT_WARRANT_DATA_FREQUENCY,
'' RIGHT_WRANT_DATA_SUB_RESP_DATE,
'' RIGHT_WRANT_DTA_SELL_RESP_DATE,
'' RGT_WRT_DATA_EQITY_Dlvry_DATE,
'' RGT_WRT_EXRCS_FRAC_SCRT_TREATT,
'' RIGHT_WARRANT_ASSED_VALUE_PYMT,
'' RIGHT_WRT_ASSED_VALUE_PYMNT_DT,
'' RIGHT_WRT_ASSED_VALUE_PYMNT_TP,
'' RGHT_WRT_ASSED_VALUE_PYMNT_ABS,
'' RGHT_WRT_ASSED_VALUE_PMT_PCNT
FROM SECM S
INNER JOIN CUST C ON TRIM(S.ISSUER)=TRIM(C.CNO)
inner join (SELECT * FROM TR_EQU_AND_SEC_OUTSTANDING WHERE TRIM(TYPE)='Investments' AND TRIM(NETQTY) != 0 
AND TRIM(NETQTY) IS NOT NULL AND CASE WHEN TRIM(SECID)='ABK TREASURY' AND TRIM(PORT) !='TS' THEN 0 ELSE 1  END = 1) b on trim(b.SECID) = trim(s.SECID) 
;
COMMIT;
EXIT; 
