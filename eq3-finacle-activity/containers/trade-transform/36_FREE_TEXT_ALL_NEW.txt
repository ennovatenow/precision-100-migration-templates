TRUNCATE TABLE TF_TFTT;

INSERT INTO TF_TFTT
select 'BNKGR' MODULE_ID, TO_CHAR(TRIM(BG_NUM)) TEXT_ID,'C' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
CONDITIONS,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O,TF001
WHERE M.KEY97=O.KEY97 AND M.REFNO_PFIX='SBG'
AND TRIM(BG_NUM)=TRIM(REPLACE(MASTER_REF,'/','-'))
AND FUNC_CODE='A' AND TRIM(DBMS_LOB.SUBSTR(CONDITIONS,2700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
select 'BNKGR' MODULE_ID, TO_CHAR(TRIM(BG_NUM)) TEXT_ID,'C' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
CONDITIONS,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O,TF002
WHERE M.KEY97=O.KEY97 AND M.REFNO_PFIX='SBG'
AND CASE WHEN TRIM(BG_TYPE)='ICLG' THEN SUBSTR(TRIM(BG_NUM),2,13) ELSE TRIM(BG_NUM) END=TRIM(REPLACE(MASTER_REF,'/','-'))
AND FUNC_CODE='A' AND TRIM(DBMS_LOB.SUBSTR(CONDITIONS,2700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
select 'BNKGR' MODULE_ID, TO_CHAR(REPLACE(MASTER_REF,'/','-')) TEXT_ID,'F' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
SBG.FFRMINSTR, 
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS MA 
LEFT JOIN BASEEVENT_ODS BE ON BE.MASTER_KEY=MA.KEY97
LEFT JOIN ISSUESBG_ODS SBG ON SBG.KEY97=BE.KEY97
WHERE MA.REFNO_PFIX='SBG' AND MA.STATUS='LIV' AND MA.LIAB_AMT!=0 AND BE.REFNO_PFIX='ISS' AND BE.STATUS='c'
AND TRIM(DBMS_LOB.SUBSTR(SBG.FFRMINSTR,2700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'BNKGR' MODULE_ID, TO_CHAR(REPLACE(MA.MASTER_REF,'/','-')) TEXT_ID,'I' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
IMP.ISS_INSTR,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS MA 
LEFT JOIN BASEEVENT_ODS BE ON BE.MASTER_KEY=MA.KEY97
LEFT JOIN NEWIMPORT_ODS IMP ON IMP.KEY97=BE.KEY97
WHERE MA.REFNO_PFIX='SBG' AND MA.STATUS='LIV' AND MA.LIAB_AMT!=0 AND BE.REFNO_PFIX='ISS' AND BE.STATUS='c'
AND TRIM(DBMS_LOB.SUBSTR(IMP.ISS_INSTR,2700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'BNKGR' MODULE_ID, REPLACE(MASTER_REF,'/','-') TEXT_ID,'G' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
GOODS_DESC,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O,TF001 T
WHERE M.KEY97=O.KEY97 AND M.REFNO_PFIX='SBG'
AND TRIM(BG_NUM)=TRIM(REPLACE(MASTER_REF,'/','-'))
AND FUNC_CODE='E' AND TRIM(DBMS_LOB.SUBSTR(GOODS_DESC,700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'BNKGR' MODULE_ID, REPLACE(MASTER_REF,'/','-') TEXT_ID,'I' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE, TO_CHAR(I.SPEC_INSTR) TEXT,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M
LEFT JOIN BASEEVENT_ODS B ON B.MASTER_KEY=M.KEY97
LEFT JOIN INITPTPNEV_ODS I ON I.KEY97=B.KEY97
LEFT JOIN PARTPNMSTR_ODS P ON P.KEY97=M.KEY97
WHERE M.REFNO_PFIX='PTN'
AND TRIM(M.STATUS)='LIV'
AND M.LIAB_AMT!=0
AND B.REFNO_PFIX IN ('CRE','AMD')
AND TRIM(I.SPEC_INSTR) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'BNKGR' MODULE_ID, REPLACE(MASTER_REF,'/','-') TEXT_ID,'C' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE, TO_CHAR(I.INSTR_PTNS) TEXT,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M
LEFT JOIN BASEEVENT_ODS B ON B.MASTER_KEY=M.KEY97
LEFT JOIN INITPTPNEV_ODS I ON I.KEY97=B.KEY97
LEFT JOIN PARTPNMSTR_ODS P ON P.KEY97=M.KEY97
WHERE M.REFNO_PFIX='PTN'
AND TRIM(M.STATUS)='LIV'
AND M.LIAB_AMT!=0
AND B.REFNO_PFIX IN ('CRE','AMD')
AND TRIM(I.INSTR_PTNS) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'BNKGR' MODULE_ID, REPLACE(MASTER_REF,'/','-') TEXT_ID,'F' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE, TO_CHAR(I.CUSTNOTES) TEXT,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M
LEFT JOIN BASEEVENT_ODS B ON B.MASTER_KEY=M.KEY97
LEFT JOIN INITPTPNEV_ODS I ON I.KEY97=B.KEY97
LEFT JOIN PARTPNMSTR_ODS P ON P.KEY97=M.KEY97
WHERE M.REFNO_PFIX='PTN'
AND TRIM(M.STATUS)='LIV'
AND M.LIAB_AMT!=0
AND B.REFNO_PFIX IN ('CRE','AMD')
AND TRIM(I.CUSTNOTES) IS NOT NULL; 

COMMIT;

INSERT INTO TF_TFTT
SELECT 'DOCCR' MODULE_ID, TO_CHAR(REPLACE(MASTER_REF,'/','-')) TEXT_ID,'C' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
CONDITIONS,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O,TF004
WHERE M.KEY97=O.KEY97
AND TRIM(DC_NUM)=TRIM(REPLACE(MASTER_REF,'/','-'))
AND FUNC_CODE='S' AND TRIM(DBMS_LOB.SUBSTR(CONDITIONS,2700)) IS NOT NULL; 

COMMIT;

INSERT INTO TF_TFTT
SELECT 'DOCCR' MODULE_ID, TO_CHAR(REPLACE(MASTER_REF,'/','-')) TEXT_ID,'C' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
CONDITIONS,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O,TF005
WHERE M.KEY97=O.KEY97
AND TRIM(DC_NUM)=TRIM(REPLACE(MASTER_REF,'/','-'))
AND FUNC_CODE='E' AND TRIM(DBMS_LOB.SUBSTR(CONDITIONS,2700)) IS NOT NULL; 

COMMIT;

INSERT INTO TF_TFTT
SELECT 'DOCCR' MODULE_ID, TO_CHAR(REPLACE(MASTER_REF,'/','-')) TEXT_ID,'S' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
PMT_DTLS,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O,TF004
WHERE M.KEY97=O.KEY97
AND TRIM(DC_NUM)=TRIM(REPLACE(MASTER_REF,'/','-'))
AND FUNC_CODE='S' 
AND TRIM(DBMS_LOB.SUBSTR(PMT_DTLS,700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'DOCCR' MODULE_ID, TO_CHAR(REPLACE(MASTER_REF,'/','-')) TEXT_ID,'S' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
PMT_DTLS,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O,TF005
WHERE M.KEY97=O.KEY97
AND TRIM(DC_NUM)=TRIM(REPLACE(MASTER_REF,'/','-'))
AND FUNC_CODE='E' 
AND TRIM(DBMS_LOB.SUBSTR(PMT_DTLS,700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'DOCCR' MODULE_ID, TO_CHAR(REPLACE(MASTER_REF,'/','-')) TEXT_ID,'H' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
CHG_TXT,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O,TF004 
WHERE M.KEY97=O.KEY97
AND TRIM(DC_NUM)=TRIM(REPLACE(MASTER_REF,'/','-')) AND FUNC_CODE='S' AND TRIM(DBMS_LOB.SUBSTR(CHG_TXT,2700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'DOCCR' MODULE_ID, TO_CHAR(REPLACE(MASTER_REF,'/','-')) TEXT_ID,'H' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
CHG_TXT,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O,TF005 
WHERE M.KEY97=O.KEY97
AND TRIM(DC_NUM)=TRIM(REPLACE(MASTER_REF,'/','-')) AND FUNC_CODE='E' AND TRIM(DBMS_LOB.SUBSTR(CHG_TXT,2700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'DOCCR' MODULE_ID, TO_CHAR(REPLACE(MASTER_REF,'/','-')) TEXT_ID,'O' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
SHIP_PRD,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O, TF004
WHERE M.KEY97=O.KEY97
AND TRIM(DC_NUM)=TRIM(REPLACE(MASTER_REF,'/','-'))
AND FUNC_CODE='S' AND TRIM(DBMS_LOB.SUBSTR(SHIP_PRD,700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'DOCCR' MODULE_ID, TO_CHAR(REPLACE(MASTER_REF,'/','-')) TEXT_ID,'O' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
SHIP_PRD,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O, TF005
WHERE M.KEY97=O.KEY97
AND TRIM(DC_NUM)=TRIM(REPLACE(MASTER_REF,'/','-'))
AND FUNC_CODE='E' AND TRIM(DBMS_LOB.SUBSTR(SHIP_PRD,700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'DOCCR' MODULE_ID, TO_CHAR(REPLACE(MASTER_REF,'/','-')) TEXT_ID,'G' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
GOODS_DESC,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O,TF004 T
WHERE M.KEY97=O.KEY97
AND TRIM(DC_NUM)=TRIM(REPLACE(MASTER_REF,'/','-'))
AND FUNC_CODE='S' AND TRIM(DBMS_LOB.SUBSTR(GOODS_DESC,700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'DOCCR' MODULE_ID, TO_CHAR(REPLACE(MASTER_REF,'/','-')) TEXT_ID,'G' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
GOODS_DESC,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O,TF005 T
WHERE M.KEY97=O.KEY97
AND TRIM(DC_NUM)=TRIM(REPLACE(MASTER_REF,'/','-'))
AND FUNC_CODE='E' AND TRIM(DBMS_LOB.SUBSTR(GOODS_DESC,700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'DOCCR' MODULE_ID, TO_CHAR(REPLACE(MASTER_REF,'/','-')) TEXT_ID,'D' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
DOCS_RQD,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O,TF004
WHERE M.KEY97=O.KEY97
AND TRIM(REPLACE(MASTER_REF,'/','-'))=TRIM(DC_NUM)
AND FUNC_CODE='S' AND TRIM(DBMS_LOB.SUBSTR(DOCS_RQD,700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'DOCCR' MODULE_ID, TO_CHAR(REPLACE(MASTER_REF,'/','-')) TEXT_ID,'D' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
DOCS_RQD,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O,TF005
WHERE M.KEY97=O.KEY97
AND TRIM(REPLACE(MASTER_REF,'/','-'))=TRIM(DC_NUM)
AND FUNC_CODE='E' AND TRIM(DBMS_LOB.SUBSTR(DOCS_RQD,700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'DOCCR' MODULE_ID, TO_CHAR(REPLACE(MASTER_REF,'/','-')) TEXT_ID,'PN' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
TEXT15,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O,TF004 T
WHERE M.KEY97=O.KEY97
AND REPLACE(MASTER_REF,'/','-')=TRIM(DC_NUM)
AND FUNC_CODE='S' AND TRIM(DBMS_LOB.SUBSTR(TEXT15,2700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'DOCCR' MODULE_ID, TO_CHAR(REPLACE(MASTER_REF,'/','-')) TEXT_ID,'PN' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
TEXT15,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O,TF005 T
WHERE M.KEY97=O.KEY97
AND REPLACE(MASTER_REF,'/','-')=TRIM(DC_NUM)
AND FUNC_CODE='E' AND TRIM(DBMS_LOB.SUBSTR(TEXT15,2700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'DOCCR' MODULE_ID, TO_CHAR(REPLACE(MASTER_REF,'/','-')) TEXT_ID,'P' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
TO_CHAR(trim(trim(PRES_PRD)||' '||TRIM(TRIM(PRESPNARR1)||PRESPNARR2||PRESPNARR3||PRESPNARR4))) TEXT,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O, TF004 T
WHERE M.KEY97=O.KEY97 AND T.FUNC_CODE='S'
AND TRIM(REPLACE(MASTER_REF,'/','-'))=TRIM(DC_NUM)
AND trim(trim(PRES_PRD)||' '||TRIM(TRIM(PRESPNARR1)||PRESPNARR2||PRESPNARR3||PRESPNARR4)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'DOCCR' MODULE_ID, TO_CHAR(REPLACE(MASTER_REF,'/','-')) TEXT_ID,'P' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
TO_CHAR(trim(trim(PRES_PRD)||' '||TRIM(TRIM(PRESPNARR1)||PRESPNARR2||PRESPNARR3||PRESPNARR4))) TEXT,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O, TF005 T
WHERE M.KEY97=O.KEY97 AND T.FUNC_CODE='E'
AND TRIM(REPLACE(MASTER_REF,'/','-'))=TRIM(DC_NUM)
AND trim(trim(PRES_PRD)||' '||TRIM(TRIM(PRESPNARR1)||PRESPNARR2||PRESPNARR3||PRESPNARR4)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT DISTINCT 'DOCCR' MODULE_ID, TO_CHAR(TRIM(DC_NUM)) TEXT_ID,'N' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE, TO_CHAR(TRIM(TRIM(PA.REFERENCE)||' '||TRIM(PA.ADDRESS1))) TEXT,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
from tidataitem_ods ti
INNER JOIN MASTER_ODS MO ON MO.KEY97=TI.MASTER_KEY
INNER JOIN TF004 T1 ON TRIM(T1.DC_NUM)=REPLACE(MO.MASTER_REF,'/','-')
inner join (select * from partydtls_ods where role='INS') pa on ti.key97=pa.key97
where ti.typeflag='27713' AND TRIM(TRIM(PA.REFERENCE)||' '||TRIM(PA.ADDRESS1)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT DISTINCT 'DOCCR' MODULE_ID, REPLACE(MASTER_REF,'/','-') TEXT_ID,'E' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
TO_CHAR(CASE WHEN TRIM(TENOR_FROM)='S' THEN TO_CHAR('SIGHT PAYMENT') 
     WHEN TRIM(TENOR_FROM)='A' THEN TO_CHAR('AIR WAY BILL')
     WHEN TRIM(TENOR_FROM)='I' THEN TO_CHAR('INVOICE')
     WHEN TRIM(TENOR_FROM)='L' THEN TO_CHAR('FROM NEGOTIATION DATE')
     WHEN TRIM(TENOR_FROM)='G' THEN TO_CHAR('ARRIVAL OF GOODS')
     WHEN TRIM(TENOR_FROM)='P' THEN TO_CHAR('SHIPPING DATE')
     ELSE TRIM(TO_CHAR(TENOR_FROM)) END) TEXT,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O, TF004
WHERE M.KEY97=O.KEY97
AND TRIM(DC_NUM)=TRIM(REPLACE(MASTER_REF,'/','-'))
AND trim(TENOR_FROM) IS NOT NULL
AND FUNC_CODE='S';

COMMIT;

INSERT INTO TF_TFTT
SELECT DISTINCT 'DOCCR' MODULE_ID, REPLACE(MASTER_REF,'/','-') TEXT_ID,'E' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
TO_CHAR(CASE WHEN TRIM(TENOR_FROM)='S' THEN TO_CHAR('SIGHT PAYMENT') 
     WHEN TRIM(TENOR_FROM)='A' THEN TO_CHAR('AIR WAY BILL')
     WHEN TRIM(TENOR_FROM)='I' THEN TO_CHAR('INVOICE')
     WHEN TRIM(TENOR_FROM)='L' THEN TO_CHAR('FROM NEGOTIATION DATE')
     WHEN TRIM(TENOR_FROM)='G' THEN TO_CHAR('ARRIVAL OF GOODS')
     WHEN TRIM(TENOR_FROM)='P' THEN TO_CHAR('SHIPPING DATE')
     ELSE TRIM(TO_CHAR(TENOR_FROM)) END) TEXT,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS M , LCMASTER_ODS O, TF005
WHERE M.KEY97=O.KEY97
AND TRIM(DC_NUM)=TRIM(REPLACE(MASTER_REF,'/','-'))
AND trim(TENOR_FROM) IS NOT NULL
AND FUNC_CODE='E' AND TRIM(TENOR_FROM) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'DOCCR' MODULE_ID, REPLACE(MA.MASTER_REF,'/','-') TEXT_ID,'M' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
TRIM(DBMS_LOB.SUBSTR(NE.NARRATIVE,32700)),
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
--SELECT REPLACE(MA.MASTER_REF,'/','-') MASTER_REF,
--trim(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(TRIM(DBMS_LOB.SUBSTR(NE.NARRATIVE,32700)),CHR(10),''),CHR(13),''),CHR(09),''),CHR(43),''),CHR(40),''),CHR(41),''),CHR(44),''),CHR(47),''),CHR(58),''),CHR(34),''),CHR(39),'')) NARRATIVE 
FROM MASTER_ODS MA 
INNER JOIN TF_ELC_MASTER TF ON MA.MASTER_REF=TF.MASTER_REF
LEFT JOIN BASEEVENT_ODS BE ON BE.MASTER_KEY=MA.KEY97 AND BE.REFNO_PFIX='ADE'
LEFT JOIN NEWEXPORT_ODS NE ON NE.KEY97=BE.KEY97
WHERE TRIM(DBMS_LOB.SUBSTR(NE.NARRATIVE,700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'FBILL' MODULE_ID, TO_CHAR(BILLID) TEXT_ID,'L' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
LCPAY.DOC_DISCR,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM MASTER_ODS MA
LEFT JOIN BASEEVENT_ODS BE ON BE.MASTER_KEY=MA.KEY97
INNER JOIN TF010_LC TLC ON REPLACE(TRIM(MA.MASTER_REF),'/','-')=TRIM(TLC.NUM)
LEFT JOIN LCPAYMENT_ODS LCPAY ON LCPAY.KEY97=BE.KEY97
WHERE BE.REFNO_PFIX='CLM' AND BE.STATUS='c' AND TO_NUMBER(SUBSTR(BILLID,14,3))=LPAD(BE.REFNO_SERL,3,0)
AND TRIM(DBMS_LOB.SUBSTR(LCPAY.DOC_DISCR,2700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
SELECT 'FBILL' MODULE_ID, REPLACE(MASTER_REF,'/','-') TEXT_ID,'M' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
CM.RSP_TO_SND,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM TIDATAITEM_ODS T
INNER JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
INNER JOIN TF009 ON TRIM(BILLID)=REPLACE(MASTER_REF,'/','-')
WHERE T.TYPEFLAG IN ('336','7490','2051','9389')
AND TRIM(CD.STATUS) NOT IN ('RT','P') 
AND TRIM(CM.RSP_TO_SND) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
select 'FBILL' MODULE_ID, REPLACE(MASTER_REF,'/','-') TEXT_ID,'M' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'N' DEL_FLG, '' FUNC_CODE,
CM.RSP_TO_SND,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM TIDATAITEM_ODS T
INNER JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
INNER JOIN TF010 T10 ON TRIM(BILLID)=REPLACE(MASTER_REF,'/','-')
WHERE T.TYPEFLAG IN ('336','7490','2051','9389')
AND TRIM(CD.STATUS) NOT IN ('RT','P')
AND TRIM(CM.RSP_TO_SND) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
select 'MEOB' MODULE_ID, REPLACE(MASTER_REF,'/','-') TEXT_ID,'CD' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'Y' DEL_FLG, '' FUNC_CODE,
CM.GOODS_DESC,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM TIDATAITEM_ODS T
INNER JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
INNER JOIN TF009 ON TRIM(BILLID)=REPLACE(MASTER_REF,'/','-')
WHERE T.TYPEFLAG IN ('336','7490','2051','9389')
AND TRIM(CD.STATUS) NOT IN ('RT','P')
AND TRIM(DBMS_LOB.SUBSTR(CM.GOODS_DESC,700)) IS NOT NULL;

COMMIT;

INSERT INTO TF_TFTT
select 'MIIB' MODULE_ID, REPLACE(MASTER_REF,'/','-') TEXT_ID,'CD' TEXT_TYPE, 'Y' ENTITY_CRE_FLG,'Y' DEL_FLG, '' FUNC_CODE,
CM.GOODS_DESC,
'SYSTEM' LCHG_USER_ID, SYSDATE LCHG_TIME, 'SYSTEM' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT,'01' BANK_ID
FROM TIDATAITEM_ODS T
INNER JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
INNER JOIN TF010 T10 ON TRIM(BILLID)=REPLACE(MASTER_REF,'/','-')
WHERE T.TYPEFLAG IN ('336','7490','2051','9389')
AND TRIM(DBMS_LOB.SUBSTR(CM.GOODS_DESC,700)) IS NOT NULL;

COMMIT;

DELETE FROM TF_TFTT WHERE TRIM(DBMS_LOB.SUBSTR(TEXT,2700)) IS NULL;

COMMIT;

UPDATE TF_TFTT SET TEXT=REPLACE(REPLACE(regexp_replace(TEXT,'(*[[:punct:]])',' '),CHR(10),' '),CHR(13),' ');

COMMIT;


TRUNCATE TABLE TF_FREE_TEXT_TF009_TENOR;

INSERT INTO TF_FREE_TEXT_TF009_TENOR
select REPLACE(MASTER_REF,'/','-') MASTER_REF,
'E' CODE,
CASE WHEN TRIM(CD.TENOR_FROM)='S' THEN TO_CHAR('SIGHT PAYMENT') 
     WHEN TRIM(CD.TENOR_FROM)='A' THEN TO_CHAR('AIR WAY BILL')
     WHEN TRIM(CD.TENOR_FROM)='I' THEN TO_CHAR('INVOICE DATE')
     WHEN TRIM(CD.TENOR_FROM)='L' THEN TO_CHAR('BILL OF LADING')
     WHEN TRIM(CD.TENOR_FROM)='E' THEN TO_CHAR('BILL OF EXCHANGE')
     WHEN TRIM(CD.TENOR_FROM)='P' THEN TO_CHAR('SHIPMENT DATE')
     ELSE TRIM(TO_CHAR(CD.TENOR_FROM)) END TENOR_FROM
FROM TIDATAITEM_ODS T
INNER JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
INNER JOIN TF009 ON TRIM(BILLID)=REPLACE(MASTER_REF,'/','-')
WHERE T.TYPEFLAG IN ('336','7490','2051','9389')
AND TRIM(CD.STATUS) NOT IN ('RT','P');

COMMIT;

TRUNCATE TABLE TF_FREE_TEXT_TF010_TENOR;

INSERT INTO TF_FREE_TEXT_TF010_TENOR
select DISTINCT REPLACE(M.MASTER_REF,'/','-') MASTER_REF,
'E' CODE,
CASE WHEN TRIM(CD.TENOR_FROM)='S' THEN TO_CHAR('SIGHT PAYMENT') 
     WHEN TRIM(CD.TENOR_FROM)='A' THEN TO_CHAR('AIR WAY BILL')
     WHEN TRIM(CD.TENOR_FROM)='I' THEN TO_CHAR('INVOICE DATE')
     WHEN TRIM(CD.TENOR_FROM)='L' THEN TO_CHAR('BILL OF LADING')
     WHEN TRIM(CD.TENOR_FROM)='E' THEN TO_CHAR('BILL OF EXCHANGE')
     WHEN TRIM(CD.TENOR_FROM)='P' THEN TO_CHAR('SHIPMENT DATE')
     ELSE TRIM(TO_CHAR(CD.TENOR_FROM)) END TENOR_FROM
FROM TIDATAITEM_ODS T
INNER JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
INNER JOIN TF010 T10 ON TRIM(BILLID)=REPLACE(MASTER_REF,'/','-')
WHERE T.TYPEFLAG IN ('336','7490','2051','9389')
AND TRIM(CD.STATUS) NOT IN ('RT','P');

COMMIT;

TRUNCATE TABLE TF_FRTT_FXM;

INSERT INTO TF_FRTT_FXM
SELECT
'FBILL' B2K_TYPE, REPLACE(MASTER_REF,'/','-') B2K_ID, 'O' MSG_CLASS, '0002' MSG_SRL_NUM, 'Y' ENTITY_CRE_FLG, 'N' DEL_FLG, 'OBREF' RMT_CODE, SYSDATE MSG_DATE, TRIM(B.THEIR_REF) MSG, '' MSG_SUB_CLASS,
'UBSADMIN' LCHG_USER_ID, SYSDATE LCHG_TIME, 'UBSADMIN' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT, '01' BANK_ID, '' MSG_STATUS, '' STATUS_DATE
FROM TIDATAITEM_ODS T
LEFT JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
INNER JOIN BASEEVENT_ODS B ON B.MASTER_KEY=M.KEY97 AND B.REFNO_PFIX='CRE'
WHERE CD.O_S_AMT!=0 AND M.TOTLIABAMT!=0 AND M.STATUS='LIV' AND M.REFNO_PFIX IN 'COL' AND TRIM(CD.STATUS) NOT IN ('RT','P');

COMMIT;

INSERT INTO TF_FRTT_FXM
SELECT
'FBILL' B2K_TYPE, REPLACE(MASTER_REF,'/','-') B2K_ID, 'O' MSG_CLASS, '0002' MSG_SRL_NUM, 'Y' ENTITY_CRE_FLG, 'N' DEL_FLG, 'OBREF' RMT_CODE, SYSDATE MSG_DATE, TRIM(B.THEIR_REF) MSG, '' MSG_SUB_CLASS,
'UBSADMIN' LCHG_USER_ID,SYSDATE LCHG_TIME, 'UBSADMIN' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT, '01' BANK_ID, '' MSG_STATUS, '' STATUS_DATE
FROM TIDATAITEM_ODS T
INNER JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
INNER JOIN BASEEVENT_ODS B ON B.MASTER_KEY=M.KEY97 AND B.REFNO_PFIX='CRE'
WHERE T.TYPEFLAG IN ('336','7490','2051','9389') AND TRIM(M.STATUS)='LIV' AND CD.O_S_AMT!=0 AND M.REFNO_PFIX = 'OUD' AND TRIM(CD.STATUS) NOT IN ('RT','P') AND M.AMT_O_S !=0;

COMMIT;

--========================CHANGED AS PER NIRAJ'S MAIL - 17-08-2017 CHANGED TO TFTT INSTEAD OF FXM TABLE ==========================

--INSERT INTO TF_FRTT_FXM
--SELECT
--'FBILL' B2K_TYPE, replace(M.MASTER_REF,'/','-') B2K_ID, 'O' MSG_CLASS, '0001' MSG_SRL_NUM, 'Y' ENTITY_CRE_FLG, 'N' DEL_FLG, 'GDDES' RMT_CODE, SYSDATE MSG_DATE, TRIM(DBMS_LOB.SUBSTR(CM.GOODS_DESC,200)) MSG,
--'' MSG_SUB_CLASS, 'UBSADMIN' LCHG_USER_ID, SYSDATE LCHG_TIME, 'UBSADMIN' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT, '01' BANK_ID, '' MSG_STATUS, '' STATUS_DATE
--FROM TIDATAITEM_ODS T
--INNER JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
--INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
--INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
--INNER JOIN TF009 ON TRIM(BILLID)=REPLACE(MASTER_REF,'/','-')
--WHERE T.TYPEFLAG IN ('336','7490','2051','9389')
--AND TRIM(CD.STATUS) NOT IN ('RT','P')
--AND TRIM(DBMS_LOB.SUBSTR(CM.GOODS_DESC,700)) IS NOT NULL;

--COMMIT;

--INSERT INTO TF_FRTT_FXM
--SELECT
--'FBILL' B2K_TYPE, replace(M.MASTER_REF,'/','-') B2K_ID, 'O' MSG_CLASS, '0001' MSG_SRL_NUM, 'Y' ENTITY_CRE_FLG, 'N' DEL_FLG, 'GDDES' RMT_CODE, SYSDATE MSG_DATE, TRIM(DBMS_LOB.SUBSTR(CM.GOODS_DESC,200)) MSG,
--'' MSG_SUB_CLASS, 'UBSADMIN' LCHG_USER_ID, SYSDATE LCHG_TIME, 'UBSADMIN' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT, '01' BANK_ID, '' MSG_STATUS, '' STATUS_DATE
--FROM TIDATAITEM_ODS T
--INNER JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
--INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
--INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
--INNER JOIN TF010 T10 ON TRIM(BILLID)=REPLACE(MASTER_REF,'/','-')
--WHERE T.TYPEFLAG IN ('336','7490','2051','9389')
--AND TRIM(DBMS_LOB.SUBSTR(CM.GOODS_DESC,700)) IS NOT NULL;

--COMMIT;

--========================CHANGED AS PER NIRAJ'S MAIL - 17-08-2017 CHANGED TO TFTT INSTEAD OF FXM TABLE ==========================

INSERT INTO TF_FRTT_FXM
SELECT
'FBILL' B2K_TYPE, BILLID B2K_ID, 'O' MSG_CLASS, '0001' MSG_SRL_NUM, 'Y' ENTITY_CRE_FLG, 'N' DEL_FLG, 'GDDES' RMT_CODE, SYSDATE MSG_DATE,  
replace(replace(TRIM(DBMS_LOB.SUBSTR(LCPAY.PRIN_NOTES,200)),CHR(10),''),CHR(13),'') MSG, --TRIM(DBMS_LOB.SUBSTR(LCPAY.PRIN_NOTES,200)) MSG,
'' MSG_SUB_CLASS, 'UBSADMIN' LCHG_USER_ID, SYSDATE LCHG_TIME, 'UBSADMIN' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT, '01' BANK_ID, '' MSG_STATUS, '' STATUS_DATE
FROM MASTER_ODS MA
LEFT JOIN BASEEVENT_ODS BE ON BE.MASTER_KEY=MA.KEY97
INNER JOIN TF010_LC TLC ON REPLACE(TRIM(MA.MASTER_REF),'/','-')=TRIM(TLC.NUM)
LEFT JOIN LCPAYMENT_ODS LCPAY ON LCPAY.KEY97=BE.KEY97
WHERE BE.REFNO_PFIX='CLM' AND BE.STATUS='c' AND TO_NUMBER(SUBSTR(BILLID,14,3))=LPAD(BE.REFNO_SERL,3,0)
AND TRIM(DBMS_LOB.SUBSTR(LCPAY.PRIN_NOTES,200)) IS NOT NULL;

COMMIT;

INSERT INTO TF_FRTT_FXM
SELECT
'FBILL' B2K_TYPE, BILLID B2K_ID, 'O' MSG_CLASS, '0003' MSG_SRL_NUM, 'Y' ENTITY_CRE_FLG, 'N' DEL_FLG, 'PRINN' RMT_CODE, SYSDATE MSG_DATE, TRIM(DBMS_LOB.SUBSTR(LCPAY.PRES_NOTES,200)) MSG,
'' MSG_SUB_CLASS, 'UBSADMIN' LCHG_USER_ID, SYSDATE LCHG_TIME, 'UBSADMIN' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT, '01' BANK_ID, '' MSG_STATUS, '' STATUS_DATE
FROM MASTER_ODS MA
LEFT JOIN BASEEVENT_ODS BE ON BE.MASTER_KEY=MA.KEY97
INNER JOIN TF010_LC TLC ON REPLACE(TRIM(MA.MASTER_REF),'/','-')=TRIM(TLC.NUM)
LEFT JOIN LCPAYMENT_ODS LCPAY ON LCPAY.KEY97=BE.KEY97
WHERE BE.REFNO_PFIX='CLM' AND BE.STATUS='c' AND TO_NUMBER(SUBSTR(BILLID,14,3))=LPAD(BE.REFNO_SERL,3,0)
AND TRIM(DBMS_LOB.SUBSTR(LCPAY.PRES_NOTES,200)) IS NOT NULL;

COMMIT;

INSERT INTO TF_FRTT_FXM
SELECT DISTINCT
'FBILL' B2K_TYPE, replace(M.MASTER_REF,'/','-') B2K_ID, 'O' MSG_CLASS, '0004' MSG_SRL_NUM, 'Y' ENTITY_CRE_FLG, 'N' DEL_FLG, 'SPL' RMT_CODE, SYSDATE MSG_DATE, 
replace(replace(TRIM(DBMS_LOB.SUBSTR(SPCL_INSTR,200)),CHR(10),''),CHR(13),'') MSG,
--TRIM(DBMS_LOB.SUBSTR(SPCL_INSTR,200)) MSG,
'' MSG_SUB_CLASS, 'UBSADMIN' LCHG_USER_ID, SYSDATE LCHG_TIME, 'UBSADMIN' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT, '01' BANK_ID, '' MSG_STATUS, '' STATUS_DATE
FROM TIDATAITEM_ODS T
INNER JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
INNER JOIN TF010 T10 ON TRIM(BILLID)=REPLACE(MASTER_REF,'/','-')
WHERE T.TYPEFLAG IN ('336','7490','2051','9389')
AND TRIM(CD.STATUS) NOT IN ('RT','P');

COMMIT;

INSERT INTO TF_FRTT_FXM
SELECT DISTINCT
'FBILL' B2K_TYPE, replace(M.MASTER_REF,'/','-') B2K_ID, 'O' MSG_CLASS, '0004' MSG_SRL_NUM, 'Y' ENTITY_CRE_FLG, 'N' DEL_FLG, 'SPL' RMT_CODE, SYSDATE MSG_DATE, 
replace(replace(TRIM(DBMS_LOB.SUBSTR(SPCL_INSTR,200)),CHR(10),''),CHR(13),'') MSG,
--TRIM(DBMS_LOB.SUBSTR(SPCL_INSTR,200)) MSG,
'' MSG_SUB_CLASS, 'UBSADMIN' LCHG_USER_ID, SYSDATE LCHG_TIME, 'UBSADMIN' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT, '01' BANK_ID, '' MSG_STATUS, '' STATUS_DATE
FROM TIDATAITEM_ODS T
INNER JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
INNER JOIN TF009 T9 ON TRIM(BILLID)=REPLACE(MASTER_REF,'/','-')
WHERE T.TYPEFLAG IN ('336','7490','2051','9389')
AND TRIM(CD.STATUS) NOT IN ('RT','P')
AND TRIM(DBMS_LOB.SUBSTR(SPCL_INSTR,200)) IS NOT NULL;

COMMIT;

UPDATE TF_FRTT_FXM SET MSG=REPLACE(REPLACE(regexp_replace(MSG,'(*[[:punct:]])',' '),CHR(10),' '),CHR(13),' ');

COMMIT;

TRUNCATE TABLE TF_FREE_MSG;

INSERT INTO TF_FREE_MSG
SELECT REPLACE(MA.MASTER_REF,'/','-') B2KID, '    0' MSG_SRL_NUM, 'M' MSG_CLASS, 'Y' ENTITY_CRE_FLG, 'N' DEL_FLG, 'BNKGR' B2KID_TYPE, SYSDATE MSG_DATE, BE.THEIR_REF MESSAGE,
'UBSADMIN' LCHG_USER_ID, SYSDATE LCHG_TIME, 'UBSADMIN' RCRE_USER_ID, SYSDATE RCRE_TIME, '0' TS_CNT, '01' BANK_ID, '' INSTRUCTION_BY
FROM MASTER_ODS MA
INNER JOIN TF_RISKPART_MASTER RM ON RM.MASTER_REF=MA    .MASTER_REF
INNER JOIN BASEEVENT_ODS BE ON MA.KEY97=BE.MASTER_KEY AND BE.REFNO_PFIX='CRE' AND BE.STATUS='c'
WHERE TRIM(BE.THEIR_REF) IS NOT NULL;

COMMIT;


UPDATE TF_FREE_MSG SET MESSAGE=REPLACE(REPLACE(regexp_replace(MESSAGE,'(*[[:punct:]])',' '),CHR(10),' '),CHR(13),' ');

COMMIT;

DROP TABLE TF_BG_OPEN_ENDED;

CREATE TABLE TF_BG_OPEN_ENDED AS
SELECT TRIM(T1.BG_NUM) BG_NUM,--T1.BG_EXPIRY_DATE,OP.EXPIRY_DATE,
CASE WHEN TRIM(OP.EXPIRY_DATE) IS NOT NULL THEN TO_CHAR(OP.EXPIRY_DATE,'DD-MM-YYYY') ELSE TO_CHAR(T1.BG_EXPIRY_DATE) END BG_EXPIRY_DATE 
FROM MASTER_ODS MA
INNER JOIN TF001 T1 ON TRIM(BG_NUM)=REPLACE(MASTER_REF,'/','-') AND FUNC_CODE='A'
LEFT JOIN TF_BG_PPC OP ON OP.BG_NUM=REPLACE(MASTER_REF,'/','-')
WHERE MA.EXPIRY_DAT IS NULL
UNION ALL
SELECT TRIM(T2.BG_NUM),--T2.BG_EXPIRY_DATE,OP.EXPIRY_DATE,
CASE WHEN TRIM(OP.EXPIRY_DATE) IS NOT NULL THEN TO_CHAR(OP.EXPIRY_DATE,'DD-MM-YYYY') ELSE TO_CHAR(T2.BG_EXPIRY_DATE) END BG_EXPIRY_DATE 
FROM MASTER_ODS MA
INNER JOIN TF002 T2 ON TRIM(T2.BG_NUM)='X'||REPLACE(MASTER_REF,'/','-') AND FUNC_CODE='A'
LEFT JOIN TF_BG_PPC OP ON OP.BG_NUM=REPLACE(MASTER_REF,'/','-')
WHERE MA.EXPIRY_DAT IS NULL;

COMMIT;

--TRUNCATE TABLE TF_FREE_TEXT_PRIN_NOTES_BILLS; ---ALREADY INCLUDED TO FXM TABLE

--INSERT INTO TF_FREE_TEXT_PRIN_NOTES_BILLS
--SELECT '01'BANK_ID,BILLID MASTER_REF,'S' CODE,
--trim(REPLACE(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(TRIM(DBMS_LOB.SUBSTR(LCPAY.PRIN_NOTES,32700)),CHR(10),''),CHR(13),''),CHR(09),''),CHR(43),''),CHR(40),''),CHR(41),''),CHR(44),''),CHR(47),''),CHR(58),''),CHR(34),''),CHR(39),''),'-',' ')) PRIN_NOTES
--FROM MASTER_ODS MA
--LEFT JOIN BASEEVENT_ODS BE ON BE.MASTER_KEY=MA.KEY97
--INNER JOIN TF010_LC TLC ON REPLACE(TRIM(MA.MASTER_REF),'/','-')=TRIM(TLC.NUM)
--LEFT JOIN LCPAYMENT_ODS LCPAY ON LCPAY.KEY97=BE.KEY97
--WHERE BE.REFNO_PFIX='CLM' AND BE.STATUS='c' AND TO_NUMBER(SUBSTR(BILLID,14,3))=LPAD(BE.REFNO_SERL,3,0)
--AND TRIM(DBMS_LOB.SUBSTR(LCPAY.PRIN_NOTES,32700)) IS NOT NULL;

--commit;

--TRUNCATE TABLE TF_FREE_TEXT_PRES_NOTES_BILLS; ---ALREADY INCLUDED TO FXM TABLE

--INSERT INTO TF_FREE_TEXT_PRES_NOTES_BILLS 
--SELECT '01'BANK_ID,BILLID MASTER_REF,'S' CODE,
--trim(REPLACE(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(TRIM(DBMS_LOB.SUBSTR(LCPAY.PRES_NOTES,32700)),CHR(10),''),CHR(13),''),CHR(09),''),CHR(43),''),CHR(40),''),CHR(41),''),CHR(44),''),CHR(47),''),CHR(58),''),CHR(34),''),CHR(39),''),'-',' ')) PRES_NOTES
--FROM MASTER_ODS MA
--LEFT JOIN BASEEVENT_ODS BE ON BE.MASTER_KEY=MA.KEY97
--INNER JOIN TF010_LC TLC ON REPLACE(TRIM(MA.MASTER_REF),'/','-')=TRIM(TLC.NUM)
--LEFT JOIN LCPAYMENT_ODS LCPAY ON LCPAY.KEY97=BE.KEY97
--WHERE BE.REFNO_PFIX='CLM' AND BE.STATUS='c' AND TO_NUMBER(SUBSTR(BILLID,14,3))=LPAD(BE.REFNO_SERL,3,0)
--AND TRIM(DBMS_LOB.SUBSTR(LCPAY.PRES_NOTES,32700)) IS NOT NULL;

--commit;

TRUNCATE TABLE TF_BG_AMEND_DETAILS;

INSERT INTO TF_BG_AMEND_DETAILS 
SELECT BG_NUM,TO_CHAR(BE.FINISHED,'DD-MM-YYYY') LAST_AMEND_DATE,BE.REFNO_SERL LAST_SRL_NUM
FROM TF001 T1
LEFT JOIN MASTER_ODS MO ON REPLACE(MASTER_REF,'/','-')=TRIM(BG_NUM)
LEFT JOIN ( SELECT A.* FROM BASEEVENT_ODS A 
LEFT JOIN (SELECT MASTER_KEY,REFNO_PFIX,MAX(REFNO_SERL) REFNO_SERL FROM BASEEVENT_ODS WHERE REFNO_PFIX='AMD' GROUP BY MASTER_KEY,REFNO_PFIX) B 
ON A.MASTER_KEY=B.MASTER_KEY AND A.REFNO_PFIX=B.REFNO_PFIX AND A.REFNO_SERL=B.REFNO_SERL WHERE B.MASTER_KEY IS NOT NULL)
 BE ON BE.MASTER_KEY=MO.KEY97
WHERE T1.FUNC_CODE='A';

commit;


TRUNCATE TABLE TF_ILC_AMEND_DETAILS;

INSERT INTO TF_ILC_AMEND_DETAILS
SELECT DC_NUM,TO_CHAR(BE.FINISHED,'DD-MM-YYYY') LAST_AMEND_DATE,BE.REFNO_SERL LAST_SRL_NUM
FROM TF004 T4
LEFT JOIN MASTER_ODS MO ON REPLACE(MASTER_REF,'/','-')=TRIM(DC_NUM)
LEFT JOIN ( SELECT A.* FROM BASEEVENT_ODS A 
LEFT JOIN (SELECT MASTER_KEY,REFNO_PFIX,MAX(REFNO_SERL) REFNO_SERL FROM BASEEVENT_ODS WHERE REFNO_PFIX='AMD' GROUP BY MASTER_KEY,REFNO_PFIX) B 
ON A.MASTER_KEY=B.MASTER_KEY AND A.REFNO_PFIX=B.REFNO_PFIX AND A.REFNO_SERL=B.REFNO_SERL WHERE B.MASTER_KEY IS NOT NULL)
 BE ON BE.MASTER_KEY=MO.KEY97
WHERE T4.FUNC_CODE='S';

commit;

TRUNCATE TABLE TF_FREE_TEXT_SHIPMENT_MODE;

INSERT INTO TF_FREE_TEXT_SHIPMENT_MODE 
SELECT DC_NUM,US.LONGNAME, 
CASE WHEN TRIM(US.CODE)='CMB' THEN '004'
     WHEN TRIM(US.CODE)='AIR' THEN '001'
     WHEN TRIM(US.CODE)='VES' THEN '003'
     WHEN TRIM(US.CODE)='TRK' THEN '002'
END RCT_CODE_89
FROM MASTER_ODS 
INNER JOIN USEROPTN_ODS US ON US.KEY29=USEROPTN3
INNER JOIN TF004 T4 ON TRIM(DC_NUM)=REPLACE(MASTER_REF,'/','-') AND FUNC_CODE='S'
WHERE REFNO_PFIX='ILC';

commit;


TRUNCATE TABLE TF_FREE_TEXT_TF009_RSP_TO_SND; ---ALREADY ADDED TO TFTT SCRIPT

INSERT INTO TF_FREE_TEXT_TF009_RSP_TO_SND 
select REPLACE(MASTER_REF,'/','-') MASTER_REF, 'M' CODE, CM.RSP_TO_SND
FROM TIDATAITEM_ODS T
INNER JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
INNER JOIN TF009 ON TRIM(BILLID)=REPLACE(MASTER_REF,'/','-')
WHERE T.TYPEFLAG IN ('336','7490','2051','9389')
AND TRIM(CD.STATUS) NOT IN ('RT','P');

commit;

TRUNCATE TABLE TF_FREE_TEXT_TF009_SHIPMENT;

INSERT INTO TF_FREE_TEXT_TF009_SHIPMENT 
select REPLACE(M.MASTER_REF,'/','-') MASTER_REF,
REPLACE(CM.SHIP_FROM,'-',' ') SHIP_FROM,REPLACE(CM.SHIP_TO,'-',' ') SHIP_TO,REPLACE(CM.VESSEL,'-',' ') VESSEL,REPLACE(trim(CM.SHIP_FROM),'-',' ')||' '||REPLACE(trim(CM.SHIP_TO),'-',' ')||' '||REPLACE(CM.VESSEL,'-',' ') Details 
FROM TIDATAITEM_ODS T
INNER JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
INNER JOIN TF009 ON TRIM(BILLID)=REPLACE(MASTER_REF,'/','-')
WHERE T.TYPEFLAG IN ('336','7490','2051','9389')
AND TRIM(CD.STATUS) NOT IN ('RT','P')
AND TRIM(CM.SHIP_FROM||CM.SHIP_TO||CM.VESSEL) IS NOT NULL;

commit;

TRUNCATE TABLE TF_FREE_TEXT_TF010_RSP_TO_SND;     --- ALREADY ADDED TO TFTT SCRIPT

INSERT INTO TF_FREE_TEXT_TF010_RSP_TO_SND 
select REPLACE(M.MASTER_REF,'/','-') MASTER_REF, 'M' CODE,CM.RSP_TO_SND
FROM TIDATAITEM_ODS T
INNER JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
INNER JOIN TF010 T10 ON TRIM(BILLID)=REPLACE(MASTER_REF,'/','-')
WHERE T.TYPEFLAG IN ('336','7490','2051','9389')
AND TRIM(CD.STATUS) NOT IN ('RT','P');

commit;

TRUNCATE TABLE TF_FREE_TEXT_TF010_SHIPMENT;

INSERT INTO TF_FREE_TEXT_TF010_SHIPMENT 
select REPLACE(M.MASTER_REF,'/','-') MASTER_REF,
REPLACE(CM.SHIP_FROM,'-',' ') SHIP_FROM,REPLACE(CM.SHIP_TO,'-',' ') SHIP_TO,REPLACE(CM.VESSEL,'-',' ') VESSEL,REPLACE(trim(CM.SHIP_FROM),'-',' ')||' '||REPLACE(trim(CM.SHIP_TO),'-',' ')||' '||REPLACE(CM.VESSEL,'-',' ') Details 
FROM TIDATAITEM_ODS T
INNER JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
INNER JOIN TF010 T10 ON TRIM(BILLID)=REPLACE(MASTER_REF,'/','-')
WHERE T.TYPEFLAG IN ('336','7490','2051','9389')
AND TRIM(CM.SHIP_FROM||CM.SHIP_TO||CM.VESSEL) IS NOT NULL;

commit;

TRUNCATE TABLE TF_BG_ISSUE_DATE;

INSERT INTO TF_BG_ISSUE_DATE 
SELECT TO_CHAR(REPLACE(MA.MASTER_REF,'/','-')) MASTER_REF,TO_CHAR(min(LC.ISSUE_DATE),'DD-MM-YYYY') ISSUE_DATE FROM MASTER_ODS MA
INNER JOIN BASEEVENT_ODS BE ON BE.MASTER_KEY=MA.KEY97 
LEFT JOIN LCINITIAL_ODS LC ON BE.KEY97=LC.KEY97
WHERE MA.REFNO_PFIX ='SBG' AND MA.STATUS='LIV' AND MA.LIAB_AMT!=0 AND BE.REFNO_PFIX='ISS' AND BE.STATUS='c'  
group by MASTER_REF
UNION
SELECT TO_CHAR(TRIM(BG_NUM)) MASTER_REF,TO_CHAR(min(LC.ISSUE_DATE),'DD-MM-YYYY') ISSUE_DATE FROM MASTER_ODS MA
INNER JOIN BASEEVENT_ODS BE ON BE.MASTER_KEY=MA.KEY97 
LEFT JOIN LCINITIAL_ODS LC ON BE.KEY97=LC.KEY97
INNER JOIN TF002 T2 ON REPLACE(MASTER_REF,'/','-')=CASE WHEN TRIM(BG_TYPE)='ICLG' THEN TRIM(SUBSTR(BG_NUM,2,13)) ELSE TRIM(BG_NUM) END AND FUNC_CODE='A'
WHERE MA.REFNO_PFIX ='SBG' AND MA.STATUS='LIV' AND MA.LIAB_AMT!=0 AND BE.REFNO_PFIX='ISS'  AND BE.STATUS='c' 
group by TRIM(BG_NUM);

commit;


TRUNCATE TABLE TF_LC_ISSUE_DATE;

INSERT INTO TF_LC_ISSUE_DATE 
SELECT TO_CHAR(REPLACE(MA.MASTER_REF,'/','-')) MASTER_REF,TO_CHAR(min(LC.ISSUE_DATE),'DD-MM-YYYY') ISSUE_DATE FROM MASTER_ODS MA
INNER JOIN BASEEVENT_ODS BE ON BE.MASTER_KEY=MA.KEY97 AND BE.STATUS='c'
LEFT JOIN LCINITIAL_ODS LC ON BE.KEY97=LC.KEY97
INNER JOIN TF_ILC_MASTER TF ON MA.MASTER_REF=TF.MASTER_REF
group by MA.MASTER_REF
UNION ALL
SELECT TO_CHAR(REPLACE(MA.MASTER_REF,'/','-')) MASTER_REF,TO_CHAR(min(LC.ISSUE_DATE),'DD-MM-YYYY') ISSUE_DATE FROM MASTER_ODS MA
INNER JOIN BASEEVENT_ODS BE ON BE.MASTER_KEY=MA.KEY97 AND BE.STATUS='c'
LEFT JOIN LCINITIAL_ODS LC ON BE.KEY97=LC.KEY97
INNER JOIN TF_ELC_MASTER TF ON MA.MASTER_REF=TF.MASTER_REF
group by MA.MASTER_REF;

COMMIT;

TRUNCATE TABLE TF_RISK_EFFECT_DATE;

INSERT INTO TF_RISK_EFFECT_DATE 
SELECT REPLACE(MA.MASTER_REF,'/','-') MASTER_REF,TO_CHAR(min(PT.EFFECT_DAT),'DD-MM-YYYY') EFFECTIVE_DATE
FROM MASTER_ODS MA 
LEFT JOIN PARTPNMSTR_ODS PT ON PT.KEY97=MA.KEY97
WHERE MA.REFNO_PFIX='PTN' AND MA.STATUS='LIV' AND MA.LIAB_AMT!=0 group by MASTER_REF;

COMMIT;

TRUNCATE TABLE BG_EXPIRY_PLACE; 

INSERT INTO BG_EXPIRY_PLACE  
(SELECT BG_NUM,EXPIRY_LOC FROM MASTER_ODS,TF001 WHERE TRIM(REPLACE(MASTER_REF,'/','-'))=TRIM(BG_NUM) AND FUNC_CODE='A'
UNION
SELECT BG_NUM,EXPIRY_LOC FROM MASTER_ODS,TF002 WHERE TRIM(REPLACE(MASTER_REF,'/','-'))=TRIM(BG_NUM) AND FUNC_CODE='A');

COMMIT;

TRUNCATE TABLE ELC_EXPIRY_PLACE; 

INSERT INTO ELC_EXPIRY_PLACE  
SELECT DC_NUM,EXPIRY_LOC FROM MASTER_ODS,TF005 WHERE TRIM(REPLACE(MASTER_REF,'/','-'))=TRIM(DC_NUM) AND FUNC_CODE='E';

COMMIT;

TRUNCATE TABLE TF_BG_EXPIRY_DATE;

INSERT INTO TF_BG_EXPIRY_DATE 
SELECT TRIM(T.BG_NUM) BG_NUM,TO_CHAR(M.EXPIRY_DAT,'DD-MM-YYYY') EXPIRY_DATE 
FROM TF001 T
INNER JOIN MASTER_ODS M ON TRIM(T.BG_NUM)=REPLACE(TRIM(M.MASTER_REF),'/','-')
WHERE FUNC_CODE='A' AND TRIM(EXPIRY_DAT) IS NOT NULL
UNION
SELECT TRIM(T.BG_NUM) BG_NUM,TO_CHAR(M.EXPIRY_DAT,'DD-MM-YYYY') EXPIRY_DATE 
FROM TF002 T
INNER JOIN MASTER_ODS M ON CASE WHEN TRIM(BG_TYPE)='ICLG' THEN SUBSTR(TRIM(BG_NUM),2,13) ELSE TRIM(BG_NUM) END=TRIM(REPLACE(MASTER_REF,'/','-'))
WHERE FUNC_CODE='A' AND TRIM(EXPIRY_DAT) IS NOT NULL
UNION
SELECT TRIM(T.BG_NUM) BG_NUM,TO_CHAR(M.EXPIRY_DAT,'DD-MM-YYYY') EXPIRY_DATE 
FROM TF001_RISK T
INNER JOIN MASTER_ODS M ON TRIM(T.BG_NUM)=REPLACE(TRIM(M.MASTER_REF),'/','-')
WHERE FUNC_CODE='A' AND TRIM(EXPIRY_DAT) IS NOT NULL;

COMMIT;

TRUNCATE TABLE TF_LC_EXPIRY_DATE;

INSERT INTO TF_LC_EXPIRY_DATE 
SELECT TRIM(REPLACE(M.MASTER_REF,'/','-')) LC_NUMBER,TO_CHAR(M.EXPIRY_DAT,'DD-MM-YYYY') EXPIRY_DATE 
FROM TF_ILC_MASTER T
INNER JOIN MASTER_ODS M ON TRIM(T.MASTER_REF)=TRIM(M.MASTER_REF)
UNION
SELECT TRIM(REPLACE(M.MASTER_REF,'/','-')) LC_NUMBER,TO_CHAR(M.EXPIRY_DAT,'DD-MM-YYYY') EXPIRY_DATE 
FROM TF_ELC_MASTER T
INNER JOIN MASTER_ODS M ON TRIM(T.MASTER_REF)=TRIM(M.MASTER_REF);

commit;

TRUNCATE TABLE TF_LC_AVAIL_BY;

INSERT INTO TF_LC_AVAIL_BY 
select TRIM(REPLACE(MA.MASTER_REF,'/','-')) MASTER_REF,
CASE WHEN AVAIL_BY='S' THEN 'P' ELSE  TO_CHAR(AVAIL_BY) END AVAIL_BY
from master_ods ma
inner join lcmaster_ods lc on lc.key97=ma.key97
INNER JOIN TF_ILC_MASTER ILC ON MA.MASTER_REF=ILC.MASTER_REF 
UNION
select TRIM(REPLACE(MA.MASTER_REF,'/','-')) MASTER_REF,
CASE WHEN AVAIL_BY='S' THEN 'P' ELSE  TO_CHAR(AVAIL_BY) END AVAIL_BY 
from master_ods ma
inner join lcmaster_ods lc on lc.key97=ma.key97
INNER JOIN TF_ELC_MASTER ELC ON MA.MASTER_REF=ELC.MASTER_REF; 

COMMIT;

TRUNCATE TABLE TF_ILC_DC_CONF;

INSERT INTO TF_ILC_DC_CONF 
SELECT DC_NUM,DC_CONFIRMATION_INSTRUCTIONS,'O' DC_CONFIRMATION_REQUIRED_BY FROM TF004 WHERE FUNC_CODE='S' AND DC_CONFIRMATION_INSTRUCTIONS='M';

COMMIT;

TRUNCATE TABLE TF_RISK_AGR_DATE;

INSERT INTO TF_RISK_AGR_DATE 
select REPLACE(MASTER_REF,'/','-') MASTER_REF,TO_CHAR(CTRCT_DATE,'DD-MM-YYYY') REF_DATE from MASTER_ODS WHERE LIAB_AMT!=0 AND REFNO_PFIX='PTN' AND STATUS='LIV';

COMMIT;

---SELECT MASTER_REF,PORT,COUNT(1) FROM TF_LC_SHIPMENT GROUP BY MASTER_REF,PORT HAVING COUNT(1)>1;

TRUNCATE TABLE TF_LC_SHIPMENT;

INSERT INTO TF_LC_SHIPMENT 
SELECT REPLACE(TM.MASTER_REF,'/','-') MASTER_REF,SOE.MSG_NO,SOE.MSG_DESCR,SOE.MSG_DATA, CASE WHEN TRIM(SOE.MSG_DESCR)='Place of loading/departure' THEN 'FROM' ELSE 'TO' END PORT,LC.SHIP_FROM,LC.SHIP_TO
FROM SWIFTINFLD_ODS SOE 
LEFT JOIN TIDATAITEM_ODS TI ON SOE.KEY97=TI.KEY97
LEFT JOIN MASTER_ODS MA ON MA.KEY97=TI.MASTER_KEY
LEFT JOIN TF_ILC_MASTER TM ON TM.MASTER_REF=MA.MASTER_REF
LEFT JOIN LCMASTER_ODS LC ON LC.KEY97=MA.KEY97
WHERE TRIM(SOE.MSG_DATA) IS NOT NULL AND  SOE.MSG_NO='+44E'
AND TRIM(TM.MASTER_REF) IS NOT NULL
UNION
SELECT REPLACE(TE.MASTER_REF,'/','-') MASTER_REF,SOE.MSG_NO,SOE.MSG_DESCR,SOE.MSG_DATA, CASE WHEN TRIM(SOE.MSG_DESCR)='Place of loading/departure' THEN 'FROM' ELSE 'TO' END PORT,LC.SHIP_FROM,LC.SHIP_TO
FROM SWIFTINFLD_ODS SOE 
LEFT JOIN TIDATAITEM_ODS TI ON SOE.KEY97=TI.KEY97
LEFT JOIN BASEEVENT_ODS BE ON BE.KEY97=TI.EVENT_KEY
LEFT JOIN MASTER_ODS MB ON MB.KEY97=BE.MASTER_KEY 
LEFT JOIN TF_ILC_MASTER TE ON TE.MASTER_REF=MB.MASTER_REF 
LEFT JOIN LCMASTER_ODS LC ON LC.KEY97=MB.KEY97
WHERE TRIM(SOE.MSG_DATA) IS NOT NULL AND  SOE.MSG_NO='+44E'
AND TRIM(TE.MASTER_REF) IS NOT NULL
UNION
SELECT REPLACE(TM.MASTER_REF,'/','-') MASTER_REF,SOF.MSG_NO,SOF.MSG_DESCR,SOF.MSG_DATA,CASE WHEN TRIM(SOF.MSG_DESCR)='Place of loading/departure' THEN 'FROM' ELSE 'TO' END,LC.SHIP_FROM,LC.SHIP_TO
FROM SWIFTINFLD_ODS SOF 
LEFT JOIN TIDATAITEM_ODS TI ON SOF.KEY97=TI.KEY97
LEFT JOIN MASTER_ODS MB ON MB.KEY97=TI.MASTER_KEY
LEFT JOIN TF_ILC_MASTER TM ON TM.MASTER_REF=MB.MASTER_REF
LEFT JOIN LCMASTER_ODS LC ON LC.KEY97=MB.KEY97
WHERE TRIM(SOF.MSG_DATA) IS NOT NULL AND SOF.MSG_NO='+44F'
AND TRIM(TM.MASTER_REF) IS NOT NULL
UNION
SELECT REPLACE(TE.MASTER_REF,'/','-') MASTER_REF,SOF.MSG_NO,SOF.MSG_DESCR,SOF.MSG_DATA,CASE WHEN TRIM(SOF.MSG_DESCR)='Place of loading/departure' THEN 'FROM' ELSE 'TO' END,LC.SHIP_FROM,LC.SHIP_TO
FROM SWIFTINFLD_ODS SOF 
LEFT JOIN TIDATAITEM_ODS TI ON SOF.KEY97=TI.KEY97
LEFT JOIN BASEEVENT_ODS BE ON BE.KEY97=TI.EVENT_KEY
LEFT JOIN MASTER_ODS MB ON MB.KEY97=BE.MASTER_KEY 
LEFT JOIN TF_ILC_MASTER TE ON TE.MASTER_REF=MB.MASTER_REF 
LEFT JOIN LCMASTER_ODS LC ON LC.KEY97=MB.KEY97
WHERE TRIM(SOF.MSG_DATA) IS NOT NULL AND SOF.MSG_NO='+44F'
AND TRIM(TE.MASTER_REF) IS NOT NULL
UNION
SELECT REPLACE(TM.MASTER_REF,'/','-') MASTER_REF,SOE.MSG_NO,SOE.MSG_DESCR,SOE.MSG_DATA, CASE WHEN TRIM(SOE.MSG_DESCR)='Place of loading/departure' THEN 'FROM' ELSE 'TO' END PORT,LC.SHIP_FROM,LC.SHIP_TO
FROM SWIFTINFLD_ODS SOE 
LEFT JOIN TIDATAITEM_ODS TI ON SOE.KEY97=TI.KEY97
LEFT JOIN MASTER_ODS MA ON MA.KEY97=TI.MASTER_KEY
LEFT JOIN TF_ELC_MASTER TM ON TM.MASTER_REF=MA.MASTER_REF
LEFT JOIN LCMASTER_ODS LC ON LC.KEY97=MA.KEY97
WHERE TRIM(SOE.MSG_DATA) IS NOT NULL AND  SOE.MSG_NO='+44E'
AND TRIM(TM.MASTER_REF) IS NOT NULL
UNION
SELECT REPLACE(TE.MASTER_REF,'/','-') MASTER_REF,SOE.MSG_NO,SOE.MSG_DESCR,SOE.MSG_DATA, CASE WHEN TRIM(SOE.MSG_DESCR)='Place of loading/departure' THEN 'FROM' ELSE 'TO' END PORT,LC.SHIP_FROM,LC.SHIP_TO
FROM SWIFTINFLD_ODS SOE 
LEFT JOIN TIDATAITEM_ODS TI ON SOE.KEY97=TI.KEY97
LEFT JOIN BASEEVENT_ODS BE ON BE.KEY97=TI.EVENT_KEY
LEFT JOIN MASTER_ODS MB ON MB.KEY97=BE.MASTER_KEY 
LEFT JOIN TF_ELC_MASTER TE ON TE.MASTER_REF=MB.MASTER_REF 
LEFT JOIN LCMASTER_ODS LC ON LC.KEY97=MB.KEY97
WHERE TRIM(SOE.MSG_DATA) IS NOT NULL AND  SOE.MSG_NO='+44E'
AND TRIM(TE.MASTER_REF) IS NOT NULL
UNION
SELECT REPLACE(TM.MASTER_REF,'/','-') MASTER_REF,SOF.MSG_NO,SOF.MSG_DESCR,SOF.MSG_DATA,CASE WHEN TRIM(SOF.MSG_DESCR)='Place of loading/departure' THEN 'FROM' ELSE 'TO' END,LC.SHIP_FROM,LC.SHIP_TO
FROM SWIFTINFLD_ODS SOF 
LEFT JOIN TIDATAITEM_ODS TI ON SOF.KEY97=TI.KEY97
LEFT JOIN MASTER_ODS MB ON MB.KEY97=TI.MASTER_KEY
LEFT JOIN TF_ELC_MASTER TM ON TM.MASTER_REF=MB.MASTER_REF
LEFT JOIN LCMASTER_ODS LC ON LC.KEY97=MB.KEY97
WHERE TRIM(SOF.MSG_DATA) IS NOT NULL AND SOF.MSG_NO='+44F'
AND TRIM(TM.MASTER_REF) IS NOT NULL
UNION
SELECT REPLACE(TE.MASTER_REF,'/','-') MASTER_REF,SOF.MSG_NO,SOF.MSG_DESCR,SOF.MSG_DATA,CASE WHEN TRIM(SOF.MSG_DESCR)='Place of loading/departure' THEN 'FROM' ELSE 'TO' END,LC.SHIP_FROM,LC.SHIP_TO
FROM SWIFTINFLD_ODS SOF 
LEFT JOIN TIDATAITEM_ODS TI ON SOF.KEY97=TI.KEY97
LEFT JOIN BASEEVENT_ODS BE ON BE.KEY97=TI.EVENT_KEY
LEFT JOIN MASTER_ODS MB ON MB.KEY97=BE.MASTER_KEY 
LEFT JOIN TF_ELC_MASTER TE ON TE.MASTER_REF=MB.MASTER_REF 
LEFT JOIN LCMASTER_ODS LC ON LC.KEY97=MB.KEY97
WHERE TRIM(SOF.MSG_DATA) IS NOT NULL AND SOF.MSG_NO='+44F'
AND TRIM(TE.MASTER_REF) IS NOT NULL;

COMMIT;

TRUNCATE TABLE TF_FREE_TEXT_ELC_NARRATIVE; --- ALREADY ADDED TO TFTT SCRIPT

INSERT INTO TF_FREE_TEXT_ELC_NARRATIVE 
SELECT REPLACE(MA.MASTER_REF,'/','-') MASTER_REF,
trim(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(TRIM(DBMS_LOB.SUBSTR(NE.NARRATIVE,32700)),CHR(10),''),CHR(13),''),CHR(09),''),CHR(43),''),CHR(40),''),CHR(41),''),CHR(44),''),CHR(47),''),CHR(58),''),CHR(34),''),CHR(39),'')) NARRATIVE 
FROM MASTER_ODS MA 
LEFT JOIN BASEEVENT_ODS BE ON BE.MASTER_KEY=MA.KEY97 AND BE.REFNO_PFIX='ADE'
LEFT JOIN NEWEXPORT_ODS NE ON NE.KEY97=BE.KEY97
WHERE MA.STATUS='LIV' AND MA.LIAB_AMT!=0 AND MA.REFNO_PFIX='ELC' ;

COMMIT;

TRUNCATE TABLE TF_INW_BG_EXPIRY_PLACE;

INSERT INTO TF_INW_BG_EXPIRY_PLACE 
SELECT TRIM(BG_NUM) BG_NUM,TRIM(REF_DESC) COUNTRY
FROM TF002
LEFT JOIN MASTER_ODS MA ON REPLACE(MASTER_REF,'/','-')=CASE WHEN TRIM(BG_TYPE)='ICLG' THEN TRIM(SUBSTR(BG_NUM,2,13)) ELSE TRIM(BG_NUM) END
LEFT JOIN PARTYDTLS_ODS PCP ON PCP.KEY97=PCP_PTY
LEFT JOIN TBAADM.RCT ON REF_CODE=PCP.COUNTRY AND REF_REC_TYPE='03' AND BANK_ID='01'
WHERE FUNC_CODE='A';

COMMIT;

TRUNCATE TABLE TF_FREE_TEXT_TF010_SPL_INSTR; ---ALREADY INCLUDED TO FXM TABLE

INSERT INTO TF_FREE_TEXT_TF010_SPL_INSTR 
select DISTINCT REPLACE(M.MASTER_REF,'/','-') MASTER_REF,
'O' CODE,
trim(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(TRIM(DBMS_LOB.SUBSTR(SPCL_INSTR,32700)),CHR(10),''),CHR(13),''),CHR(09),''),CHR(43),''),CHR(40),''),CHR(41),''),CHR(44),''),CHR(47),''),CHR(58),''),CHR(34),''),CHR(39),'')) CONDITIONS
FROM TIDATAITEM_ODS T
INNER JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
INNER JOIN TF010 T10 ON TRIM(BILLID)=REPLACE(MASTER_REF,'/','-')
WHERE T.TYPEFLAG IN ('336','7490','2051','9389')
AND TRIM(CD.STATUS) NOT IN ('RT','P');

DELETE TF_FREE_TEXT_TF010_SPL_INSTR WHERE TRIM(CONDITIONS) IS NULL;

COMMIT;

TRUNCATE TABLE TF_FREE_TEXT_TF009_SPL_INSTR; ---ALREADY INCLUDED TO FXM TABLE

INSERT INTO TF_FREE_TEXT_TF009_SPL_INSTR 
select DISTINCT REPLACE(M.MASTER_REF,'/','-') MASTER_REF,
'O' CODE,
trim(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(TRIM(DBMS_LOB.SUBSTR(SPCL_INSTR,32700)),CHR(10),''),CHR(13),''),CHR(09),''),CHR(43),''),CHR(40),''),CHR(41),''),CHR(44),''),CHR(47),''),CHR(58),''),CHR(34),''),CHR(39),'')) CONDITIONS
FROM TIDATAITEM_ODS T
INNER JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
INNER JOIN TF009 T9 ON TRIM(BILLID)=REPLACE(MASTER_REF,'/','-')
WHERE T.TYPEFLAG IN ('336','7490','2051','9389')
AND TRIM(CD.STATUS) NOT IN ('RT','P');

DELETE TF_FREE_TEXT_TF009_SPL_INSTR WHERE TRIM(CONDITIONS) IS NULL;

COMMIT;

TRUNCATE TABLE TF_C_CLM;

INSERT INTO TF_C_CLM 
SELECT DISTINCT TRIM(CIF_ID),'BNKGR',TRIM(BG_TYPE),TRIM(LIMITPREFIX),TRIM(LIMITSUFFIX),'N',SYSDATE,'UBSADMIN','UBSADMIN',SYSDATE,'01' FROM TF001 WHERE FUNC_CODE='A' AND TRIM(LIMITPREFIX)||TRIM(LIMITSUFFIX) IS NOT NULL
UNION ALL
SELECT DISTINCT TRIM(CIF_ID),'BNKGR',TRIM(BG_TYPE),TRIM(LIMITPREFIX),TRIM(LIMITSUFFIX),'N',SYSDATE,'UBSADMIN','UBSADMIN',SYSDATE,'01' FROM TF001_RISK WHERE FUNC_CODE='A' AND TRIM(LIMITPREFIX)||TRIM(LIMITSUFFIX) IS NOT NULL
UNION ALL
SELECT DISTINCT TRIM(DC_CIF_ID),'DOOCCR',TRIM(DC_TYPE),TRIM(LIMITPREFIX),TRIM(LIMIT_SUFFIX),'N',SYSDATE,'UBSADMIN','UBSADMIN',SYSDATE,'01' FROM TF004 WHERE FUNC_CODE='S' AND TRIM(LIMITPREFIX)||TRIM(LIMIT_SUFFIX) IS NOT NULL;

COMMIT;

DELETE FROM TF_C_CLM WHERE (CIF_ID,PRODUCT_TYPE) IN 
(
SELECT CIF_ID,PRODUCT_TYPE FROM TF_C_CLM 
WHERE PRODUCT_TYPE='ILCF'
GROUP BY CIF_ID,PRODUCT_TYPE
HAVING COUNT(1) >1
) AND LIMIT_SUFFIX='GELCS';

COMMIT;

DROP TABLE TF_OTHER_BANK_CHARGE;

CREATE TABLE TF_OTHER_BANK_CHARGE AS
select SUBSTR(REPLACE((M.MASTER_REF),'/','-'),1,5)||'-'||SUBSTR(REPLACE((M.MASTER_REF),'/','-'),11,6)||'B'||LPAD(B.REFNO_SERL,3,0) BILL_ID,LCPAY.TOTCLM_AMT/C8PWD BILL_AMT,LCPAY.CHGADD_AMT/C8PWD CHARGE_AMT,
PARTPAY.PP_STAT STATUS
FROM MASTER_ODS M
INNER JOIN TF004 T4 ON TRIM(T4.DC_NUM)=REPLACE(M.MASTER_REF,'/','-') AND FUNC_CODE='S'
LEFT JOIN MAP_SOL SOL ON SOL.BR_CODE=CASE WHEN TRIM(M.BHALF_BRN) IS NOT NULL THEN M.BHALF_BRN ELSE M.INPUT_BRN END
LEFT JOIN LCMASTER_ODS L ON M.KEY97=L.KEY97
LEFT JOIN BASEEVENT_ODS B ON B.MASTER_KEY=M.KEY97 AND B.AMOUNT!=0
LEFT JOIN C8PF C8 ON C8.C8CCY=M.CCY
LEFT JOIN LCPAYMENT_ODS LCPAY ON LCPAY.KEY97=B.KEY97
LEFT JOIN PARTPAYMNT_ODS PARTPAY ON PARTPAY.OR_PAY_EV=B.KEY97 AND PARTPAY.PAYEV_KEY IS NULL
WHERE  B.STATUS='c'  AND TRIM(B.REFNO_PFIX) = 'CLM'
AND M.REFNO_PFIX='ILC'
AND PARTPAY.PP_STAT!='R'
AND TRIM(LCPAY.CHGADD_AMT) IS NOT NULL
AND PARTPAY.PP_STAT!='P';

COMMIT;

DROP TABLE TF_WORKGROUP;

CREATE TABLE TF_WORKGROUP AS 
SELECT REPLACE(MASTER_REF,'/','-') BG_NUM,
CASE WHEN TRIM(WORKGROUP)='SBLCMU' THEN 'SBLCM'
     WHEN TRIM(WORKGROUP)='UANNUL' THEN 'UANNL'
     WHEN TRIM(WORKGROUP)='UHALFY' THEN 'UHLFY'
     WHEN TRIM(WORKGROUP)='UQUART' THEN 'UQURT'
ELSE TRIM(WORKGROUP) END WORKGROUP
FROM MASTER_ODS WHERE REFNO_PFIX='SBG' AND LIAB_AMT!=0 AND STATUS='LIV' AND TRIM(WORKGROUP) IS NOT NULL;

COMMIT;

drop table TF_FREE_TEXT_DOC_DISCR_BILLS;

CREATE TABLE TF_FREE_TEXT_DOC_DISCR_BILLS AS
SELECT '01'BANK_ID,BILLID MASTER_REF,'L' CODE,
trim(REPLACE(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(TRIM(DBMS_LOB.SUBSTR(LCPAY.DOC_DISCR,32700)),CHR(10),''),CHR(13),''),CHR(09),''),CHR(43),''),CHR(40),''),CHR(41),''),CHR(44),''),CHR(47),''),CHR(58),''),CHR(34),''),CHR(39),''),'-',' ')) DOC_DISCR
FROM MASTER_ODS MA
LEFT JOIN BASEEVENT_ODS BE ON BE.MASTER_KEY=MA.KEY97
INNER JOIN TF010_LC TLC ON REPLACE(TRIM(MA.MASTER_REF),'/','-')=TRIM(TLC.NUM)
LEFT JOIN LCPAYMENT_ODS LCPAY ON LCPAY.KEY97=BE.KEY97
WHERE BE.REFNO_PFIX='CLM' AND BE.STATUS='c' AND TO_NUMBER(SUBSTR(BILLID,14,3))=LPAD(BE.REFNO_SERL,3,0)
AND TRIM(DBMS_LOB.SUBSTR(LCPAY.DOC_DISCR,32700)) IS NOT NULL;

commit;

TRUNCATE TABLE TF_ELC_LIAB;

COMMIT;

INSERT INTO TF_ELC_LIAB
SELECT REPLACE(MA.MASTER_REF,'/','-'),MA.CCY,MA.LIAB_AMT/C8PWD
FROM MASTER_ODS MA
INNER JOIN TF_ELC_MASTER TF ON TF.MASTER_REF=MA.MASTER_REF
LEFT JOIN C8PF ON C8CCY=MA.CCY
WHERE MA.LIAB_AMT!=0; 

COMMIT;

DROP TABLE TF_ELC_LIAB_BILL;

CREATE TABLE TF_ELC_LIAB_BILL AS 
SELECT trim(NUM) NUM,CRNCYCODE,sum(BILLAMT) TOTAL_BILLAMT
FROM TF009_LC T9 
INNER JOIN TF011_ELC T11 ON TRIM(T9.BILLID)=TRIM(T11.BILLID) 
LEFT JOIN TF005 T5 ON TRIM(DC_NUM)=TRIM(NUM)
WHERE BILLEVENTTYPE='A' AND DC_CONFIRMATION_INSTRUCTIONS='Y'
group by trim(NUM),CRNCYCODE;

COMMIT;

TRUNCATE TABLE TF_SGM;

INSERT INTO TF_SGM
SELECT TRIM(BG_NUM) BG_NUM,TRIM(REPLACE(MA.RELMSTRREF,'/','-')) DC_NUM
FROM TF001
LEFT JOIN MASTER_ODS MA ON REPLACE(MA.MASTER_REF,'/','-')=TRIM(BG_NUM)
WHERE TRIM(BG_TYPE)='LGSH' AND FUNC_CODE='A';

COMMIT;

--UPDATE TBAADM.FEI SET VESSEL_NAME=REPLACE(REPLACE(regexp_replace(VESSEL_NAME,'(*[[:punct:]])',' '),CHR(10),' '),CHR(13),' ') WHERE BANK_ID='01';
--
--UPDATE TBAADM.FEI SET ORIGIN_OF_GOODS=REPLACE(REPLACE(regexp_replace(ORIGIN_OF_GOODS,'(*[[:punct:]])',' '),CHR(10),' '),CHR(13),' ') WHERE BANK_ID='01';
--
--UPDATE TBAADM.FEI SET DEST_OF_GOODS=REPLACE(REPLACE(regexp_replace(DEST_OF_GOODS,'(*[[:punct:]])',' '),CHR(10),' '),CHR(13),' ') WHERE BANK_ID='01';
--
--
--INSERT INTO TBAADM.TFTT
--SELECT --T10.BILLID,T10.NUM,DC.DC_REF_NUM,DC.DC_B2KID,FB.BILL_B2K_ID,TT.*
--'MIIB' MODULE_ID,FB.BILL_B2K_ID TEXT_ID,'CD' TEXT_TYPE,'Y' ENTITY_CRE_FLG,'Y' DEL_FLG,'' FUNC_CODE,TT.TEXT TEXT,'SYSTEM' LCHG_USER_ID,SYSDATE LCHG_TIME,'SYSTEM' RCRE_USER_ID,SYSDATE RCRE_TIME,'0' TS_CNT,'01' BANK_ID
--FROM TF010_LC T10
--LEFT JOIN TBAADM.DCMM DC ON TRIM(T10.NUM)=DC_REF_NUM
--LEFT JOIN TBAADM.FBM FB ON FB.BILL_ID=TRIM(T10.BILLID)
--LEFT JOIN TBAADM.TFTT TT ON TT.TEXT_ID=DC.DC_B2KID AND TT.TEXT_TYPE='G' AND TT.MODULE_ID='DOCCR'
--WHERE TRIM(DBMS_LOB.SUBSTR(TT.TEXT,700)) IS NOT NULL
--UNION ALL
--SELECT --T10.BILLID,T10.NUM,DC.DC_REF_NUM,DC.DC_B2KID,FB.BILL_B2K_ID,TT.*
--'MEOB' MODULE_ID,FB.BILL_B2K_ID TEXT_ID,'CD' TEXT_TYPE,'Y' ENTITY_CRE_FLG,'Y' DEL_FLG,'' FUNC_CODE,TT.TEXT TEXT,'SYSTEM' LCHG_USER_ID,SYSDATE LCHG_TIME,'SYSTEM' RCRE_USER_ID,SYSDATE RCRE_TIME,'0' TS_CNT,'01' BANK_ID
--FROM TF009_LC T10
--LEFT JOIN TBAADM.DCMM DC ON TRIM(T10.NUM)=DC_REF_NUM
--LEFT JOIN TBAADM.FBM FB ON FB.BILL_ID=TRIM(T10.BILLID)
--LEFT JOIN TBAADM.TFTT TT ON TT.TEXT_ID=DC.DC_B2KID AND TT.TEXT_TYPE='G' AND TT.MODULE_ID='DOCCR'
--WHERE TRIM(DBMS_LOB.SUBSTR(TT.TEXT,700)) IS NOT NULL
--
--
--SELECT TRIM(DBMS_LOB.SUBSTR(TEXT,400)) FROM TBAADM.TFTT WHERE BANK_ID='01' AND TEXT_TYPE='CD' AND LENGTH(TRIM(DBMS_LOB.SUBSTR(TEXT,32000)))>400
--
--UPDATE TBAADM.TFTT SET TEXT=TRIM(DBMS_LOB.SUBSTR(TEXT,400)) WHERE BANK_ID='01' AND TEXT_TYPE='CD' AND LENGTH(TRIM(DBMS_LOB.SUBSTR(TEXT,32000)))>400
--
--
--SELECT * FROM TBAADM.FXM WHERE BANK_ID='01' AND MSG_CLASS='O' AND MSG_SRL_NUM='0001'
--UNION ALL
--SELECT * FROM TBAADM.FXM WHERE BANK_ID='01' AND MSG_CLASS='S' AND MSG_SRL_NUM='0001'

--SELECT * FROM TBAADM.BET WHERE BANK_ID='01' AND EVENT_TYPE='U' AND EVENT_AMT=0 AND AMEND_IND!='O'
--
--UPDATE TBAADM.BET SET AMEND_IND='O' WHERE BANK_ID='01' AND EVENT_TYPE='U' AND EVENT_AMT=0 AND AMEND_IND!='O'
--
--SELECT * FROM TBAADM.DCEM WHERE BANK_ID='01' AND EVENT_TYPE='A' AND EVENT_AMT=0 AND NATURE_OF_AMEND!='O'
--
--UPDATE TBAADM.DCEM SET NATURE_OF_AMEND='O' WHERE BANK_ID='01' AND EVENT_TYPE='A' AND EVENT_AMT=0 AND NATURE_OF_AMEND!='O'
--
--SELECT * FROM TBAADM.FBM WHERE BANK_ID='01' AND DUE_DT_CALC_IND!='O'
--
--UPDATE TBAADM.FBM SET DUE_DT_CALC_IND='O' WHERE BANK_ID='01' AND DUE_DT_CALC_IND!='O'

