SELECT * FROM TF010 WHERE SUBSTR(TRIM(BILLID),1,13) NOT IN 
(--SELECT * FROM PARTYDTLS_ODS WHERE KEY97 IN
SELECT DISTINCT REPLACE(MA.MASTER_REF,'/','-')
FROM TIDATAITEM_ODS TI 
LEFT JOIN MASTER_ODS MA ON TI.MASTER_KEY=MA.KEY97
LEFT JOIN PARTYDTLS_ODS PA ON PA.KEY97=TI.KEY97 AND PA.ROLE IN ('CBK','RBK') 
--LEFT JOIN PARTYDTLS_ODS PN ON PN.KEY97=MA.NPCP_PTY AND PN.ROLE IN ('CBK','RBK') 
WHERE TI.MASTER_KEY IN
(SELECT DISTINCT MA.KEY97
FROM TIDATAITEM_ODS TI
LEFT JOIN COLLDRAFT_ODS CD ON TI.KEY97=CD.KEY97
INNER JOIN MASTER_ODS MA ON TI.MASTER_KEY=MA.KEY97
LEFT JOIN PARTYDTLS_ODS PA ON TI.KEY97=PA.KEY97
WHERE TI.TYPEFLAG='336' AND CD.O_S_AMT!=0 AND MA.TOTLIABAMT!=0 AND MA.STATUS='LIV' AND MA.REFNO_PFIX IN 'COL' AND TRIM(CD.STATUS) NOT IN ('RT','P'))
AND TI.TYPEFLAG='27713' AND TRIM(ADDRESS1) IS NOT NULL)


EXEC dbms_stats.gather_table_stats('MIGAPPKW','COREINTERFACE');

EXEC DBMS_STATS.gather_schema_stats(ownname => 'MIGAPPKW', estimate_percent => 10, cascade => TRUE, NO_INVALIDATE => TRUE, METHOD_OPT => 'FOR ALL COLUMNS SIZE 1');

EXEC DBMS_STATS.gather_schema_stats(ownname => 'CRMUSER', estimate_percent => 10, cascade => TRUE, NO_INVALIDATE => TRUE, METHOD_OPT => 'FOR ALL COLUMNS SIZE 1');



SELECT MA.MASTER_REF,LIAB_AMT/C8PWD,DC_REF_NUM,CONT_LIAB_AMT,LIAB_AMT/C8PWD-CONT_LIAB_AMT DIFF
FROM MIGAPPKW.MASTER_ODS MA
INNER JOIN MIGAPPKW.TF_ILC_MASTER TF ON TF.MASTER_REF=MA.MASTER_REF
LEFT JOIN MIGAPPKW.C8PF ON C8CCY=MA.CCY
LEFT JOIN TBAADM.DCMM DC ON DC_REF_NUM=REPLACE(MA.MASTER_REF,'/','-')
WHERE LIAB_AMT/C8PWD-CONT_LIAB_AMT !=0



SELECT MA.MASTER_REF,LIAB_AMT/C8PWD,DC_REF_NUM,CONT_LIAB_AMT,LIAB_AMT/C8PWD-CONT_LIAB_AMT DIFF
FROM MIGAPPKW.MASTER_ODS MA
INNER JOIN MIGAPPKW.TF_ELC_MASTER TF ON TF.MASTER_REF=MA.MASTER_REF
LEFT JOIN MIGAPPKW.C8PF ON C8CCY=MA.CCY
LEFT JOIN TBAADM.DCMM DC ON DC_REF_NUM=REPLACE(MA.MASTER_REF,'/','-')
WHERE LIAB_AMT/C8PWD-CONT_LIAB_AMT !=0

