CREATE TABLE TF_LG_AMORT
(
REFERENCE NVARCHAR2(16),
COMMISSION NUMBER(20,4),
START_DATE DATE,
EXPIRY_DATE DATE,
TO_BE_AMORT NUMBER(20,4),
NO_OF_DAYS NUMBER (4)
);


CREATE TABLE TF_CAMT AS SELECT * FROM TBAADM.CAMT WHERE ROWNUM<1;

INSERT INTO TF_CAMT
SELECT 
'BNKGR' ENTITY_TYPE,
TRIM(T1.BG_NUM) ENTITY_ID,
--TO_CHAR(LG.START_DATE,'DD-MM-YYYY') CHARGE_COLLECT_DATE,
LG.START_DATE CHARGE_COLLECT_DATE,
'' SRL_NUM,
TRIM(SOL_ID) SOL_ID,
T1.BG_CURRENCY ENTITY_CRNCY_CODE,
'BGADD' EVENT_TYPE,
BP.EVENT_ID EVENT_ID,
'1' CHARGE_SRL_NUM,
'KWD' CHRG_CRNCY_CODE,
LG.COMMISSION TTL_CHRG_AMT,
LG.COMMISSION-LG.TO_BE_AMORT AMORTIZED_AMT,
LG.TO_BE_AMORT OUTST_AMORT_AMT,
'0' REFUND_AMT,
--TO_DATE('31-03-2017','DD-MM-YYYY') LAST_AMORT_DATE,
TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY') LAST_AMORT_DATE,
LG.NO_OF_DAYS AMORT_TENOR,
'E' AMORT_DATE_FLAG,
'70001'||PL_CHRG_BACID PL_ACCOUNT,
'70001'||BACID ADVANCE_ACCOUNT,
'N' COLLECT_TODAY_FLG,
'UBSADMIN' LCHG_USER_ID, 
SYSDATE LCHG_TIME, 
'UBSADMIN' RCRE_USER_ID, 
SYSDATE RCRE_TIME, 
0 TS_CNT, 
'01' BANK_ID,
'' TFCT_KEY_SRL_NUM
FROM TF_LG_AMORT LG
LEFT JOIN TF001 T1 ON TRIM(T1.BG_NUM)=REPLACE(LG.REFERENCE,'/','-') AND T1.FUNC_CODE='A'
LEFT JOIN TBAADM.BGP BP ON BP.BG_TYPE=TRIM(T1.BG_TYPE) AND BP.BANK_ID='01'
LEFT JOIN TBAADM.PTT PT ON PT.EVENT_ID=BP.EVENT_ID AND PT.BANK_ID='01' AND PT.EVENT_TYPE='BGADD' AND PT.PTRAN_BUS_TYPE='COMM'
LEFT JOIN MASTER_ODS MA ON MA.MASTER_REF=LG.REFERENCE
WHERE TRIM(T1.BG_NUM) IS NOT NULL;
  
COMMIT;


UPDATE TF_CAMT SET SRL_NUM=ROWNUM;

COMMIT;