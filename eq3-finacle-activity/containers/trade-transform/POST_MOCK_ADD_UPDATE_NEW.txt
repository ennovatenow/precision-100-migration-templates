TRUNCATE TABLE TF_BG_PARTY_ADD;

INSERT INTO TF_BG_PARTY_ADD
SELECT
REPLACE(SUBSTR(M.MASTER_REF,1,16),'/','-') BGSRLNUM, 
CASE WHEN TRIM(APP.ADDRESS1) IS NULL THEN '.' ELSE TRIM(APP.ADDRESS1) END APPLPARTYNAME, 
CASE WHEN TRIM(APP.ADDRESS2) IS NULL THEN '.' ELSE TRIM(APP.ADDRESS2) END APPLPARTYADDR1, 
APP.ADDRESS3 APPLPARTYADDR2, 
TRIM(SUBSTR(TRIM(TRIM(APP.ADDRESS4)||' '||TRIM(APP.ADDRESS5)),1,40)) APPLPARTYADDR3, 
' ' APPLPARTYCITY,
' ' APPLPARTYSTATE, 
APP.COUNTRY APPLPARTYCNTRY, 
TRIM(APP.ZIPCODE) APPLPARTYPINCODE, 
BEN.ADDRESS1 BENNAME,
CASE WHEN TRIM(BEN.ADDRESS2) IS NOT NULL THEN BEN.ADDRESS2 ELSE '.' END BENADDR1,
BEN.ADDRESS3 BENADDR2,
TRIM(SUBSTR(TRIM(BEN.ADDRESS4)||' '||TRIM(BEN.ADDRESS5),1,40)) BENADDR3,
' ' BENCITY,
' ' BENSTATE, 
BEN.COUNTRY BENCNTRY, 
TRIM(BEN.ZIPCODE) BENPINCODE, 
CASE WHEN TRIM(GTE_ID)='C' THEN PCP.ADDRESS1 ELSE ADVBK.ADDRESS1 END  BGCORRBANKNAME,
CASE WHEN TRIM(GTE_ID)='C' THEN PCP.ADDRESS2 ELSE ADVBK.ADDRESS2 END BGCORRBANKADDR1,
CASE WHEN TRIM(GTE_ID)='C' THEN PCP.ADDRESS3 ELSE ADVBK.ADDRESS3 END BGCORRBANKADDR2,
CASE WHEN TRIM(GTE_ID)='C' THEN TRIM(SUBSTR(TRIM(PCP.ADDRESS4)||' '||TRIM(PCP.ADDRESS5),1,35)) ELSE TRIM(SUBSTR(TRIM(ADVBK.ADDRESS4)||' '||TRIM(ADVBK.ADDRESS5),1,35)) END BGCORRBANKADDR3,
' ' BGCORRBANKCITY,
' ' BGCORRBANKSTATE,
CASE WHEN TRIM(GTE_ID)='C' THEN PCP.COUNTRY ELSE ADVBK.COUNTRY END BGCORRBANKCNTRY,
CASE WHEN TRIM(GTE_ID)='C' THEN TRIM(PCP.ZIPCODE) ELSE TRIM(ADVBK.ZIPCODE) END BGCORRBANKPINCODE,
CASE WHEN TRIM(GTE_ID)='C' THEN PCP.SW_BANK||PCP.SW_CTR||PCP.SW_LOC||PCP.SW_BRANCH ELSE ADVBK.SW_BANK||ADVBK.SW_CTR||ADVBK.SW_LOC||ADVBK.SW_BRANCH END BGBICCODE,
BG.BG_B2KID
FROM MASTER_ODS M
LEFT JOIN LCMASTER_ODS L ON M.KEY97=L.KEY97
LEFT JOIN IGMASTER_ODS I ON I.KEY97=M.KEY97
LEFT JOIN PRODTYPE_ODS PR ON TRIM(PR.KEY97)=TRIM(M.PRODTYPE) 
LEFT JOIN PARTYDTLS_ODS APP ON APP.KEY97=L.APP_PTY
LEFT JOIN PARTYDTLS_ODS BEN ON BEN.KEY97=L.BEN_PTY 
LEFT JOIN PARTYDTLS_ODS ADVBK ON ADVBK.KEY97=L.ADVBNK_PTY
LEFT JOIN PARTYDTLS_ODS PCP ON PCP.KEY97=M.PCP_PTY
LEFT JOIN TBAADM.BGM BG ON BG_SRL_NUM=REPLACE(SUBSTR(M.MASTER_REF,1,16),'/','-')
WHERE TRIM(PR.CODE) not in ('COL','NOB')
AND M.TYPEFLAG IN ('24171', '31349') AND TRIM(M.STATUS)='LIV' AND M.LIAB_AMT!=0
UNION ALL
SELECT
REPLACE(SUBSTR(M.MASTER_REF,1,16),'/','-') BGSRLNUM, 
CASE WHEN TRIM(APP.ADDRESS1) IS NULL THEN '.' ELSE TRIM(APP.ADDRESS1) END APPLPARTYNAME, 
CASE WHEN TRIM(APP.ADDRESS2) IS NULL THEN '.' ELSE TRIM(APP.ADDRESS2) END APPLPARTYADDR1, 
APP.ADDRESS3 APPLPARTYADDR2, 
TRIM(SUBSTR(TRIM(TRIM(APP.ADDRESS4)||' '||TRIM(APP.ADDRESS5)),1,40)) APPLPARTYADDR3, 
' ' APPLPARTYCITY,
' ' APPLPARTYSTATE, 
APP.COUNTRY APPLPARTYCNTRY, 
TRIM(APP.ZIPCODE) APPLPARTYPINCODE, 
BEN.ADDRESS1 BENNAME,
CASE WHEN TRIM(BEN.ADDRESS2) IS NOT NULL THEN BEN.ADDRESS2 ELSE '.' END BENADDR1,
BEN.ADDRESS3 BENADDR2,
TRIM(SUBSTR(TRIM(BEN.ADDRESS4)||' '||TRIM(BEN.ADDRESS5),1,40)) BENADDR3,
' ' BENCITY,
' ' BENSTATE, 
BEN.COUNTRY BENCNTRY, 
TRIM(BEN.ZIPCODE) BENPINCODE, 
CASE WHEN TRIM(GTE_ID)='C' THEN PCP.ADDRESS1 ELSE ADVBK.ADDRESS1 END  BGCORRBANKNAME,
CASE WHEN TRIM(GTE_ID)='C' THEN PCP.ADDRESS2 ELSE ADVBK.ADDRESS2 END BGCORRBANKADDR1,
CASE WHEN TRIM(GTE_ID)='C' THEN PCP.ADDRESS3 ELSE ADVBK.ADDRESS3 END BGCORRBANKADDR2,
CASE WHEN TRIM(GTE_ID)='C' THEN TRIM(SUBSTR(TRIM(PCP.ADDRESS4)||' '||TRIM(PCP.ADDRESS5),1,35)) ELSE TRIM(SUBSTR(TRIM(ADVBK.ADDRESS4)||' '||TRIM(ADVBK.ADDRESS5),1,35)) END BGCORRBANKADDR3,
' ' BGCORRBANKCITY,
' ' BGCORRBANKSTATE,
CASE WHEN TRIM(GTE_ID)='C' THEN PCP.COUNTRY ELSE ADVBK.COUNTRY END BGCORRBANKCNTRY,
CASE WHEN TRIM(GTE_ID)='C' THEN TRIM(PCP.ZIPCODE) ELSE TRIM(ADVBK.ZIPCODE) END BGCORRBANKPINCODE,
CASE WHEN TRIM(GTE_ID)='C' THEN PCP.SW_BANK||PCP.SW_CTR||PCP.SW_LOC||PCP.SW_BRANCH ELSE ADVBK.SW_BANK||ADVBK.SW_CTR||ADVBK.SW_LOC||ADVBK.SW_BRANCH END BGBICCODE,
BG.BG_B2KID
FROM MASTER_ODS M
LEFT JOIN LCMASTER_ODS L ON M.KEY97=L.KEY97
LEFT JOIN IGMASTER_ODS I ON I.KEY97=M.KEY97
LEFT JOIN PRODTYPE_ODS PR ON TRIM(PR.KEY97)=TRIM(M.PRODTYPE) 
LEFT JOIN PARTYDTLS_ODS APP ON APP.KEY97=L.APP_PTY
LEFT JOIN PARTYDTLS_ODS BEN ON BEN.KEY97=L.BEN_PTY 
LEFT JOIN PARTYDTLS_ODS ADVBK ON ADVBK.KEY97=L.ADVBNK_PTY
LEFT JOIN PARTYDTLS_ODS PCP ON PCP.KEY97=M.PCP_PTY
LEFT JOIN TBAADM.BGM BG ON BG_SRL_NUM=REPLACE(SUBSTR(M.MASTER_REF,1,16),'/','-')
WHERE TRIM(PR.CODE) IN ('END','SHP')
AND M.TYPEFLAG IN ('24171', '31349') AND TRIM(M.STATUS)='LIV';

COMMIT;

INSERT INTO TF_BG_PARTY_ADD
SELECT
CASE WHEN TRIM(PR.CODE) IN ('NOB','COL') THEN TRIM(REPLACE (M.MASTER_REF,'/','-')) ELSE trim('X'||replace(M.master_ref,'/','-')) END BGSRLNUM,
CASE WHEN TRIM(APP.ADDRESS1) IS NOT NULL THEN TRIM(APP.ADDRESS1) ELSE '.' END APPLPARTYNAME,
CASE WHEN TRIM(APP.ADDRESS2) IS NOT NULL THEN TRIM(APP.ADDRESS2) ELSE '.' END APPLPARTYADDR1, 
APP.ADDRESS3 APPLPARTYADDR2,
TRIM(SUBSTR(TRIM(APP.ADDRESS4)||' '||TRIM(APP.ADDRESS5),1,45)) APPLPARTYADDR3, 
' ' APPLPARTYCITY,
' ' APPLPARTYSTATE, 
APP.COUNTRY APPLPARTYCNTRY, 
TRIM(APP.ZIPCODE) APPLPARTYPINCODE,
CASE WHEN TRIM(BENP.ADDRESS1) IS NOT NULL THEN TRIM(BENP.ADDRESS1) ELSE '.' END BENNAME,
CASE WHEN TRIM(BENP.ADDRESS2) IS NOT NULL THEN TRIM(BENP.ADDRESS2) ELSE '.' END BENADDR1,
BENP.ADDRESS3 BENADDR2,
TRIM(SUBSTR(TRIM(BENP.ADDRESS4)||' '||TRIM(BENP.ADDRESS5),1,45)) BENADDR3,
' ' BENCITY,
' ' BENSTATE, 
BENP.COUNTRY BENCNTRY, 
TRIM(BENP.ZIPCODE) BENPINCODE, 
PCP.ADDRESS1 BGCORRBANKNAME, 
CASE WHEN TRIM(PCP.ADDRESS2) IS NULL AND TRIM(PCP.ADDRESS1) IS NOT NULL THEN '.' ELSE TRIM(PCP.ADDRESS2) END BGCORRBANKADDR1, 
PCP.ADDRESS3 BGCORRBANKADDR2, 
TRIM(SUBSTR(TRIM(TRIM(PCP.ADDRESS4)||' '||TRIM(PCP.ADDRESS5)),1,35)) BGCORRBANKADDR3, 
' ' BGCORRBANKCITY, 
' ' BGCORRBANKSTATE, 
PCP.COUNTRY BGCORRBANKCNTRY, 
TRIM(PCP.ZIPCODE) BGCORRBANKPINCODE, 
PCP.SW_BANK||PCP.SW_CTR||PCP.SW_LOC||PCP.SW_BRANCH BGBICCODE,
BG.BG_B2KID
FROM MASTER_ODS M
LEFT JOIN LCMASTER_ODS L ON M.KEY97=L.KEY97
LEFT JOIN PARTYDTLS_ODS PCP ON PCP.KEY97=M.PCP_PTY
LEFT JOIN PARTYDTLS_ODS APP ON APP.KEY97=L.APP_PTY
LEFT JOIN PARTYDTLS_ODS BENP ON L.BEN_PTY=BENP.KEY97
LEFT JOIN IGMASTER_ODS I ON M.KEY97=I.KEY97
LEFT JOIN PRODTYPE_ODS PR ON TRIM(PR.KEY97)=TRIM(M.PRODTYPE)
LEFT JOIN TBAADM.BGM BG ON BG_SRL_NUM='X'||REPLACE(SUBSTR(M.MASTER_REF,1,16),'/','-')
WHERE M.TYPEFLAG IN ('24171', '31349') AND TRIM(M.STATUS)='LIV' AND TRIM(PR.CODE) NOT IN ('NOB','COL')
AND TRIM(GTE_ID)='C';

COMMIT;

INSERT INTO TF_BG_PARTY_ADD
SELECT
CASE WHEN TRIM(PR.CODE) IN ('NOB','COL') THEN TRIM(REPLACE (M.MASTER_REF,'/','-')) ELSE trim('X'||replace(M.master_ref,'/','-')) END BGSRLNUM,
CASE WHEN TRIM(BENP.ADDRESS1) IS NOT NULL THEN TRIM(BENP.ADDRESS1) ELSE '.' END APPLPARTYNAME,
CASE WHEN TRIM(BENP.ADDRESS2) IS NOT NULL THEN TRIM(BENP.ADDRESS2) ELSE '.' END APPLPARTYADDR1, 
BENP.ADDRESS3 APPLPARTYADDR2,
TRIM(SUBSTR(TRIM(BENP.ADDRESS4)||' '||TRIM(BENP.ADDRESS5),1,45)) APPLPARTYADDR3, 
' ' APPLPARTYCITY,
' ' APPLPARTYSTATE, 
BENP.COUNTRY APPLPARTYCNTRY, 
TRIM(BENP.ZIPCODE) APPLPARTYPINCODE,
CASE WHEN TRIM(APP.ADDRESS1) IS NOT NULL THEN TRIM(APP.ADDRESS1) ELSE '.' END BENNAME,
CASE WHEN TRIM(APP.ADDRESS2) IS NOT NULL THEN TRIM(APP.ADDRESS2) ELSE '.' END BENADDR1,
APP.ADDRESS3 BENADDR2,
TRIM(SUBSTR(TRIM(APP.ADDRESS4)||' '||TRIM(APP.ADDRESS5),1,45)) BENADDR3,
' ' BENCITY,
' ' BENSTATE, 
APP.COUNTRY BENCNTRY, 
TRIM(APP.ZIPCODE) BENPINCODE, 
PCP.ADDRESS1 BGCORRBANKNAME, 
CASE WHEN TRIM(PCP.ADDRESS2) IS NULL AND TRIM(PCP.ADDRESS1) IS NOT NULL THEN '.' ELSE TRIM(PCP.ADDRESS2) END BGCORRBANKADDR1, 
PCP.ADDRESS3 BGCORRBANKADDR2, 
TRIM(SUBSTR(TRIM(TRIM(PCP.ADDRESS4)||' '||TRIM(PCP.ADDRESS5)),1,35)) BGCORRBANKADDR3, 
' ' BGCORRBANKCITY, 
' ' BGCORRBANKSTATE, 
PCP.COUNTRY BGCORRBANKCNTRY, 
TRIM(PCP.ZIPCODE) BGCORRBANKPINCODE, 
PCP.SW_BANK||PCP.SW_CTR||PCP.SW_LOC||PCP.SW_BRANCH BGBICCODE,
BG.BG_B2KID
FROM MASTER_ODS M
LEFT JOIN LCMASTER_ODS L ON M.KEY97=L.KEY97
LEFT JOIN PARTYDTLS_ODS PCP ON PCP.KEY97=M.PCP_PTY
LEFT JOIN PARTYDTLS_ODS APP ON APP.KEY97=L.APP_PTY
LEFT JOIN PARTYDTLS_ODS BENP ON L.BEN_PTY=BENP.KEY97
LEFT JOIN IGMASTER_ODS I ON M.KEY97=I.KEY97
LEFT JOIN PRODTYPE_ODS PR ON TRIM(PR.KEY97)=TRIM(M.PRODTYPE)
LEFT JOIN TBAADM.BGM BG ON BG_SRL_NUM=REPLACE(SUBSTR(M.MASTER_REF,1,16),'/','-')
WHERE M.TYPEFLAG IN ('24171', '31349') AND TRIM(M.STATUS)='LIV' AND TRIM(PR.CODE) IN ('NOB','COL')
AND TRIM(GTE_ID)='C';

COMMIT;

INSERT INTO TF_BG_PARTY_ADD
SELECT
REPLACE(SUBSTR(M.MASTER_REF,1,16),'/','-') BGSRLNUM, 
CASE WHEN TRIM(PCP.ADDRESS1) IS NOT NULL THEN TRIM(PCP.ADDRESS1) ELSE '.' END APPLPARTYNAME, 
PCP.ADDRESS2 APPLPARTYADDR1, 
PCP.ADDRESS3 APPLPARTYADDR2, 
SUBSTR(TRIM(TRIM(PCP.ADDRESS4)||' '||TRIM(PCP.ADDRESS5)),1,40) APPLPARTYADDR3, 
'' APPLPARTYCITY,
'' APPLPARTYSTATE, 
PCP.COUNTRY APPLPARTYCNTRY, 
TRIM(PCP.ZIPCODE) APPLPARTYPINCODE, 
BEN.ADDRESS1 BENNAME,
CASE WHEN TRIM(BEN.ADDRESS2) IS NOT NULL THEN BEN.ADDRESS2 ELSE '.' END BENADDR1,
BEN.ADDRESS3 BENADDR2,
TRIM(SUBSTR(TRIM(BEN.ADDRESS4)||' '||TRIM(BEN.ADDRESS5),1,40)) BENADDR3,
'' BENCITY,
'' BENSTATE, 
BEN.COUNTRY BENCNTRY, 
TRIM(BEN.ZIPCODE) BENPINCODE,
'','','','','','','','','',BG.BG_B2KID
FROM MASTER_ODS M
INNER JOIN TF_RISKPART_MASTER RP ON RP.MASTER_REF=M.MASTER_REF
LEFT JOIN PARTPNMSTR_ODS PTN ON M.KEY97=PTN.KEY97
LEFT JOIN IGMASTER_ODS I ON I.KEY97=M.KEY97
LEFT JOIN PRODTYPE_ODS PR ON TRIM(PR.KEY97)=TRIM(M.PRODTYPE)
LEFT JOIN PARTYDTLS_ODS PCP ON PCP.KEY97=M.PCP_PTY
LEFT JOIN PARTYDTLS_ODS BEN ON BEN.KEY97=M.NPCP_PTY 
LEFT JOIN TBAADM.BGM BG ON BG_SRL_NUM=REPLACE(SUBSTR(M.MASTER_REF,1,16),'/','-')
WHERE REFNO_PFIX='PTN' ;

COMMIT;

TRUNCATE TABLE TF_LC_PARTY_ADD;

COMMIT;

INSERT INTO TF_LC_PARTY_ADD
SELECT
TRIM(REPLACE (M.MASTER_REF,'/','-')) DCNUM,
TRIM(PCPP.ADDRESS1) DCPARTYNAME,
PCPP.ADDRESS2 DCPARTYADDR1,
PCPP.ADDRESS3 DCPARTYADDR2, 
TRIM(PCPP.ADDRESS4)||TRIM(PCPP.ADDRESS5) DCPARTYADDR3, 
' ' DCPARTYCITY, 
' ' DCPARTYSTATE, 
PCPP.COUNTRY DCPARTYCNTRY, 
TRIM(PCPP.ZIPCODE) DCPARTYPINCODE, 
TRIM(BENP.ADDRESS1) DCBENEFNAME,
CASE WHEN TRIM(BENP.ADDRESS2) IS NOT NULL THEN TRIM(BENP.ADDRESS2) ELSE '.' END DCBENEFADDR1,
TRIM(BENP.ADDRESS3) DCBENEFADDR2,
SUBSTR(TRIM(TRIM(BENP.ADDRESS4)||' '||TRIM(BENP.ADDRESS5)),1,45) DCBENEFADDR3,
' ' DCBENEFCITY,
' ' DCBENEFSTATE, 
BENP.COUNTRY DCBENEFCNTRY, 
SUBSTR(trim(BENP.ZIPCODE),1,10) DCBENEFPINCODE, 
TRIM(CA.CABRN) DCAPPL_BANK_NAME,  
CASE WHEN TRIM(CA.CABAD2) IS NULL THEN '.' ELSE TRIM(CA.CABAD2) END DCAPPL_BANK_ADDR1, 
CA.CABAD3 DCAPPL_BANK_ADDR2, 
CA.CABAD4 DCAPPL_BANK_ADDR3, 
' ' DCAPPL_BANK_CITY,
' ' DCAPPL_BANK_STATE, 
'KW' DCAPPL_BANK_CNTRY, 
' ' DCAPPL_BANK_PINCODE, 
CA.CASWB||CA.CACNAS||CA.CASWL||CA.CASWBR DCAPPL_BANK_BIC, 
TRIM(CA.CABRN) DCISSUE_BANK_NAME,
CASE WHEN TRIM(CA.CABAD2) IS NULL THEN '.' ELSE TRIM(CA.CABAD2) END DCISSUE_BANK_ADDR1, 
CA.CABAD3 DCISSUE_BANK_ADDR2, 
CA.CABAD4 DCISSUE_BANK_ADDR3, 
' ' DCISSUE_BANK_CITY,
' ' DCISSUE_BANK_STATE, 
'KW' DCISSUE_BANK_CNTRY, 
' ' DCISSUE_BANK_PINCODE, 
CA.CASWB||CA.CACNAS||CA.CASWL||CA.CASWBR DCISSUE_BANK_BIC, 
ADVP.ADDRESS1 DCADV_BANK_NAME,
CASE WHEN TRIM(ADVP.ADDRESS2) IS NULL AND TRIM(ADVP.ADDRESS1) IS NOT NULL THEN '.' ELSE TRIM(ADVP.ADDRESS2) END DCADV_BANK_ADDR1,
ADVP.ADDRESS3 DCADV_BANK_ADDR2,
SUBSTR(TRIM(ADVP.ADDRESS4)||' '||TRIM(ADVP.ADDRESS5),1,45) DCADV_BANK_ADDR3,
' ' DCADV_BANK_CITY,
' ' DCADV_BANK_STATE, 
ADVP.COUNTRY DCADV_BANK_CNTRY, 
SUBSTR(TRIM(ADVP.ZIPCODE),1,10) DCADV_BANK_PINCODE, 
ADVP.SW_BANK||ADVP.SW_CTR||ADVP.SW_LOC||ADVP.SW_BRANCH DCADV_BANK_BIC,
CASE WHEN TRIM(L.AVWTH_TYP)='A' THEN TRIM(ADVP.ADDRESS1)
     WHEN TRIM(L.AVWTH_TYP) IN ('I','S') THEN TRIM(TO_CHAR(CA.CABRN))
     WHEN TRIM(L.AVWTH_TYP)='U' THEN 'ANY BANK IN COUNTRY'
     WHEN TRIM(L.AVWTH_TYP)='W' THEN 'ANY BANK'
     ELSE TRIM(AVWP.ADDRESS1) END AVBLWITH_BANK_NAME,
case when trim(CASE WHEN TRIM(L.AVWTH_TYP)='A' THEN TRIM(ADVP.ADDRESS2)
     WHEN TRIM(L.AVWTH_TYP) IN ('I','S') THEN TRIM(TO_CHAR(CA.CABAD2))
     ELSE TRIM(AVWP.ADDRESS2) END) is not null then 
     (CASE WHEN TRIM(L.AVWTH_TYP)='A' THEN TRIM(ADVP.ADDRESS2)
     WHEN TRIM(L.AVWTH_TYP) IN ('I','S') THEN TRIM(TO_CHAR(CA.CABAD2))
     ELSE TRIM(AVWP.ADDRESS2) END)
     else '.' end AVBLWITH_BANK_ADDR1, 
CASE WHEN TRIM(L.AVWTH_TYP)='A' THEN TRIM(ADVP.ADDRESS3)
     WHEN TRIM(L.AVWTH_TYP) IN ('I','S') THEN TRIM(TO_CHAR(CA.CABAD3))
     ELSE TRIM(AVWP.ADDRESS3 )END AVBLWITH_BANK_ADDR2, 
CASE WHEN TRIM(L.AVWTH_TYP)='A' THEN SUBSTR(TRIM(ADVP.ADDRESS4)||' '||TRIM(ADVP.ADDRESS5),1,45)
     WHEN TRIM(L.AVWTH_TYP) IN ('I','S') THEN TRIM(TO_CHAR(CA.CABAD4))
     ELSE SUBSTR(TRIM(AVWP.ADDRESS4)||' '||TRIM(AVWP.ADDRESS5),1,45) END AVBLWITH_BANK_ADDR3, 
' ' AVBLWITH_BANK_CITY,
' ' AVBLWITH_BANK_STATE, 
CASE WHEN TRIM(L.AVWTH_TYP)='A' THEN ADVP.COUNTRY 
     WHEN TRIM(L.AVWTH_TYP) IN ('I','S') THEN 'KW'
     ELSE AVWP.COUNTRY 
END AVBLWITH_BANK_CNTRY,
CASE WHEN TRIM(L.AVWTH_TYP)='A' THEN SUBSTR(TRIM(ADVP.ZIPCODE),1,10) 
     WHEN TRIM(L.AVWTH_TYP) IN ('I','S') THEN ''
     ELSE SUBSTR(TRIM(AVWP.ZIPCODE),1,10) 
END AVBLWITH_BANK_PINCODE,
CASE WHEN TRIM(L.AVWTH_TYP)='A' THEN ADVP.SW_BANK||ADVP.SW_CTR||ADVP.SW_LOC||ADVP.SW_BRANCH
     WHEN TRIM(L.AVWTH_TYP) IN ('I','S') THEN CA.CASWB||CA.CACNAS||CA.CASWL||CA.CASWBR
     ELSE AVWP.SW_BANK||AVWP.SW_CTR||AVWP.SW_LOC||AVWP.SW_BRANCH 
END AVBLWITH_BANK_BIC, 
RMBP.ADDRESS1 RIMB_BANK_NAME, 
CASE WHEN TRIM(RMBP.ADDRESS2) IS NULL AND TRIM(RMBP.ADDRESS1) IS NOT NULL THEN '.' ELSE TRIM(RMBP.ADDRESS2) END RIMB_BANK_ADDR1,
RMBP.ADDRESS3 RIMB_BANK_ADDR2,
SUBSTR(TRIM(RMBP.ADDRESS4)||' '||TRIM(RMBP.ADDRESS5),1,45) RIMB_BANK_ADDR3, 
' ' RIMB_BANK_CITY,
' ' RIMB_BANK_STATE, 
RMBP.COUNTRY RIMB_BANK_CNTRY, 
TRIM(RMBP.ZIPCODE) RIMB_BANK_PINCODE, 
RMBP.SW_BANK||RMBP.SW_CTR||RMBP.SW_LOC||RMBP.SW_BRANCH RIMB_BANK_BIC,
ADVTP.ADDRESS1 ADVTHRU_BANK_NAME, 
CASE WHEN TRIM(ADVTP.ADDRESS2) IS NULL AND TRIM(ADVTP.ADDRESS1) IS NOT NULL THEN '.' ELSE TRIM(ADVTP.ADDRESS2) END ADVTHRU_BANK_ADDR1,
ADVTP.ADDRESS3 ADVTHRU_BANK_ADDR2, 
SUBSTR(TRIM(ADVTP.ADDRESS4)||' '||TRIM(ADVTP.ADDRESS5),1,45) ADVTHRU_BANK_ADDR3, 
' ' ADVTHRU_BANK_CITY, 
' ' ADVTHRU_BANK_STATE, 
ADVTP.COUNTRY ADVTHRU_BANK_CNTRY, 
TRIM(ADVTP.ZIPCODE) ADVTHRU_BANK_PINCODE, 
ADVTP.SW_BANK||ADVTP.SW_CTR||ADVTP.SW_LOC||ADVTP.SW_BRANCH ADVTHRU_BANK_BIC,
DC_B2KID 
FROM MASTER_ODS M
INNER JOIN TF_ILC_MASTER ILC ON ILC.MASTER_REF=M.MASTER_REF
LEFT JOIN LCMASTER_ODS L ON M.KEY97=L.KEY97
LEFT JOIN PARTYDTLS_ODS PCPP ON PCPP.KEY97=L.APP_PTY
LEFT JOIN PARTYDTLS_ODS BENP ON BENP.KEY97=L.BEN_PTY
LEFT JOIN PARTYDTLS_ODS ADVP ON ADVP.KEY97=L.ADVBNK_PTY
LEFT JOIN PARTYDTLS_ODS AVWP ON AVWP.KEY97=L.AVWBNK_PTY
LEFT JOIN PARTYDTLS_ODS RMBP ON RMBP.KEY97=L.REIMB_PTY
LEFT JOIN PARTYDTLS_ODS THRD ON THRD.KEY97=L.THIRD_PTY
LEFT JOIN PARTYDTLS_ODS ADVTP ON ADVTP.KEY97=L.ADVTHR_PTY
LEFT JOIN CAPF CA ON CA.CABBN=CASE WHEN TRIM(M.BHALF_BRN) IS NOT NULL THEN M.BHALF_BRN ELSE M.INPUT_BRN END 
LEFT JOIN PRODTYPE_ODS PR ON PR.KEY97=M.PRODTYPE
LEFT JOIN TBAADM.DCMM DC ON DC_REF_NUM=TRIM(REPLACE (M.MASTER_REF,'/','-'));

COMMIT;

INSERT INTO TF_LC_PARTY_ADD 
SELECT 
TRIM(REPLACE (M.MASTER_REF,'/','-')) DCNUM,
TRIM(BENP.ADDRESS1) OUPARTYNAME,
CASE WHEN TRIM(BENP.ADDRESS1) IS NOT NULL AND TRIM(BENP.ADDRESS2) IS NULL THEN '.' ELSE TRIM(BENP.ADDRESS2) END OUPARTYADDR1,
BENP.ADDRESS3 OUPARTYADDR2,
SUBSTR(TRIM(TRIM(BENP.ADDRESS4)||' '||TRIM(BENP.ADDRESS5)),1,45) OUPARTYADDR3, 
' ' OUPARTYCITY, 
' ' OUPARTYSTATE,
BENP.COUNTRY OUPARTYCNTRY, 
substr(TRIM(BENP.ZIPCODE),1,10) OUPARTYPINCODE,
TRIM(PCPP.ADDRESS1) DCOTNAME, 
CASE WHEN TRIM(PCPP.ADDRESS1) IS NOT NULL AND TRIM(PCPP.ADDRESS2) IS NULL THEN '.' ELSE TRIM(PCPP.ADDRESS2) END DCOTADDR1, 
TRIM(PCPP.ADDRESS3) DCOTADDR2,
SUBSTR(TRIM(TRIM(PCPP.ADDRESS4)||' '||TRIM(PCPP.ADDRESS5)),1,45) DCOTADDR3, 
'' DCOTCITY, 
'' DCOTSTATE, 
PCPP.COUNTRY DCOTCNTRY, 
SUBSTR(trim(PCPP.ZIPCODE),1,10) DCOTPINCODE, 
CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN ISSUP.ADDRESS1 ELSE RCVDP.ADDRESS1 END APPL_BANK_NAME, 
CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN (CASE WHEN TRIM(ISSUP.ADDRESS2) IS NULL THEN '.' ELSE ISSUP.ADDRESS2 END) ELSE (CASE WHEN TRIM(RCVDP.ADDRESS2) IS NULL THEN '.' ELSE RCVDP.ADDRESS2 END) END APPL_BANK_ADDR1, 
CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN ISSUP.ADDRESS3 ELSE RCVDP.ADDRESS3 END APPL_BANK_ADDR2, 
CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN TRIM(SUBSTR(TRIM(ISSUP.ADDRESS4)||' '||TRIM(ISSUP.ADDRESS5),1,45)) ELSE TRIM(SUBSTR(TRIM(RCVDP.ADDRESS4)||' '||TRIM(RCVDP.ADDRESS5),1,45)) END APPL_BANK_ADDR3,  
'' APPL_BANK_CITY, 
'' APPL_BANK_STATE, 
CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN ISSUP.COUNTRY ELSE RCVDP.COUNTRY END APPL_BANK_CNTRY, 
CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN TRIM(ISSUP.ZIPCODE) ELSE TRIM(RCVDP.ZIPCODE) END APPL_BANK_PINCODE, 
CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN ISSUP.SW_BANK||ISSUP.SW_CTR||ISSUP.SW_LOC||ISSUP.SW_BRANCH ELSE RCVDP.SW_BANK||RCVDP.SW_CTR||RCVDP.SW_LOC||RCVDP.SW_BRANCH END APPL_BANK_BIC, 
CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN ISSUP.ADDRESS1 ELSE RCVDP.ADDRESS1 END ISSUE_BANK_NAME, 
CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN (CASE WHEN TRIM(ISSUP.ADDRESS2) IS NULL THEN '.' ELSE ISSUP.ADDRESS2 END) ELSE (CASE WHEN TRIM(RCVDP.ADDRESS2) IS NULL THEN '.' ELSE RCVDP.ADDRESS2 END) END ISSUE_BANK_ADDR1, 
CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN ISSUP.ADDRESS3 ELSE RCVDP.ADDRESS3 END ISSUE_BANK_ADDR2, 
CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN TRIM(SUBSTR(TRIM(ISSUP.ADDRESS4)||' '||TRIM(ISSUP.ADDRESS5),1,45)) ELSE TRIM(SUBSTR(TRIM(RCVDP.ADDRESS4)||' '||TRIM(RCVDP.ADDRESS5),1,45)) END ISSUE_BANK_ADDR3, 
'' ISSUE_BANK_CITY, 
'' ISSUE_BANK_STATE, 
CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN ISSUP.COUNTRY ELSE RCVDP.COUNTRY END ISSUE_BANK_CNTRY, 
CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN TRIM(ISSUP.ZIPCODE) ELSE TRIM(RCVDP.ZIPCODE) END ISSUE_BANK_PINCODE,
CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN ISSUP.SW_BANK||ISSUP.SW_CTR||ISSUP.SW_LOC||ISSUP.SW_BRANCH ELSE RCVDP.SW_BANK||RCVDP.SW_CTR||RCVDP.SW_LOC||RCVDP.SW_BRANCH END ISSUE_BANK_BIC, 
TRIM(CABRN) ADV_BANK_NAME, 
CASE WHEN TRIM(CABAD2) IS NOT NULL THEN TO_CHAR(TRIM(CABAD2)) ELSE TO_CHAR('NULL') END ADV_BANK_ADDR1,
TRIM(CABAD3) ADV_BANK_ADDR2,
TRIM(CABAD4) ADV_BANK_ADDR3, 
'' ADV_BANK_CITY, 
'' ADV_BANK_STATE, 
'KW' ADV_BANK_CNTRY, 
'' ADV_BANK_PINCODE, 
CASWB||CACNAS||CASWL||CASWBR ADV_BANK_BIC, 
CASE WHEN TRIM(L.AVWTH_TYP)='A' AND TRIM(THRDP.ADDRESS1) IS NULL THEN TRIM(TO_CHAR(CA.CABRN))
     WHEN TRIM(L.AVWTH_TYP)='A' THEN TRIM(THRDP.ADDRESS1)
     WHEN TRIM(L.AVWTH_TYP)='S' THEN TRIM(TO_CHAR(CA.CABRN)) 
     WHEN TRIM(L.AVWTH_TYP)='I' THEN (CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN ISSUP.ADDRESS1 ELSE RCVDP.ADDRESS1 END)
     WHEN TRIM(L.AVWTH_TYP)='U' THEN 'ANY BANK IN COUNTRY'
     WHEN TRIM(L.AVWTH_TYP)='W' THEN 'ANY BANK'
     ELSE TRIM(AVWP.ADDRESS1) END AVBLWITH_BANK_NAME, 
CASE WHEN TRIM(L.AVWTH_TYP)='A' AND TRIM(THRDP.ADDRESS1) IS NULL THEN TRIM(TO_CHAR(CA.CABAD2))
     WHEN TRIM(L.AVWTH_TYP)='A' THEN TRIM(THRDP.ADDRESS2)
     WHEN TRIM(L.AVWTH_TYP)='S' THEN TRIM(TO_CHAR(CA.CABAD2))
     WHEN TRIM(L.AVWTH_TYP)='I' THEN (CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN (CASE WHEN TRIM(ISSUP.ADDRESS2) IS NULL THEN '.' ELSE ISSUP.ADDRESS2 END) ELSE (CASE WHEN TRIM(RCVDP.ADDRESS2) IS NULL THEN '.' ELSE RCVDP.ADDRESS2 END) END)
     WHEN TRIM(L.AVWTH_TYP)='U' THEN '.'
     WHEN TRIM(L.AVWTH_TYP)='W' THEN '.'
     ELSE TRIM(AVWP.ADDRESS2) END AVBLWITH_BANK_ADDR1, 
CASE WHEN TRIM(L.AVWTH_TYP)='A' AND TRIM(THRDP.ADDRESS1) IS NULL THEN TRIM(TO_CHAR(CA.CABAD3))
     WHEN TRIM(L.AVWTH_TYP)='A' THEN TRIM(THRDP.ADDRESS3)
     WHEN TRIM(L.AVWTH_TYP)='S' THEN TRIM(TO_CHAR(CA.CABAD3))
     WHEN TRIM(L.AVWTH_TYP)='I' THEN (CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN ISSUP.ADDRESS3 ELSE RCVDP.ADDRESS3 END)
     ELSE TRIM(AVWP.ADDRESS3 )END AVBLWITH_BANK_ADDR2,
CASE WHEN TRIM(L.AVWTH_TYP)='A' AND TRIM(THRDP.ADDRESS1) IS NULL THEN TRIM(TO_CHAR(CA.CABAD4))
     WHEN TRIM(L.AVWTH_TYP)='A' THEN SUBSTR(TRIM(THRDP.ADDRESS4)||' '||TRIM(THRDP.ADDRESS5),1,45)
     WHEN TRIM(L.AVWTH_TYP)='S' THEN TRIM(TO_CHAR(CA.CABAD4))
     WHEN TRIM(L.AVWTH_TYP)='I' THEN (CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN TRIM(SUBSTR(TRIM(ISSUP.ADDRESS4)||' '||TRIM(ISSUP.ADDRESS5),1,45)) ELSE TRIM(SUBSTR(TRIM(RCVDP.ADDRESS4)||' '||TRIM(RCVDP.ADDRESS5),1,45)) END)
     ELSE SUBSTR(TRIM(AVWP.ADDRESS4)||' '||TRIM(AVWP.ADDRESS5),1,45) END AVBLWITH_BANK_ADDR3,
'' AVBLWITH_BANK_CITY,
'' AVBLWITH_BANK_STATE, 
CASE WHEN TRIM(L.AVWTH_TYP)='A' AND TRIM(THRDP.ADDRESS1) IS NULL THEN 'KW'
     WHEN TRIM(L.AVWTH_TYP)='A' THEN SUBSTR(trim(THRDP.COUNTRY),1,10)
     WHEN TRIM(L.AVWTH_TYP)='S' THEN 'KW'
     WHEN TRIM(L.AVWTH_TYP)='I' THEN (CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN ISSUP.COUNTRY ELSE RCVDP.COUNTRY END)
     ELSE SUBSTR(trim(AVWP.COUNTRY),1,10) END AVBLWITH_BANK_CNTRY, 
CASE WHEN TRIM(L.AVWTH_TYP)='A' AND TRIM(THRDP.ADDRESS1) IS NULL THEN ''
     WHEN TRIM(L.AVWTH_TYP)='A' THEN SUBSTR(trim(THRDP.ZIPCODE),1,10)
     WHEN TRIM(L.AVWTH_TYP)='S' THEN ''
     WHEN TRIM(L.AVWTH_TYP)='I' THEN (CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN TRIM(ISSUP.ZIPCODE) ELSE TRIM(RCVDP.ZIPCODE) END)
     ELSE SUBSTR(trim(AVWP.ZIPCODE),1,10) END AVBLWITH_BANK_PINCODE, 
CASE WHEN TRIM(L.AVWTH_TYP)='A' AND TRIM(THRDP.ADDRESS1) IS NULL THEN TRIM(TRIM(CASWB)||TRIM(CACNAS)||TRIM(CASWL)||TRIM(CASWBR))
     WHEN TRIM(L.AVWTH_TYP)='A' THEN (TRIM(THRDP.SW_BANK)||TRIM(THRDP.SW_CTR)||TRIM(THRDP.SW_LOC)||TRIM(THRDP.SW_BRANCH))
     WHEN TRIM(L.AVWTH_TYP)='S' THEN TRIM(TRIM(CASWB)||TRIM(CACNAS)||TRIM(CASWL)||TRIM(CASWBR)) 
     WHEN TRIM(L.AVWTH_TYP)='I' THEN (CASE WHEN TRIM(ISSUP.ADDRESS1) IS NOT NULL THEN ISSUP.SW_BANK||ISSUP.SW_CTR||ISSUP.SW_LOC||ISSUP.SW_BRANCH ELSE RCVDP.SW_BANK||RCVDP.SW_CTR||RCVDP.SW_LOC||RCVDP.SW_BRANCH END)
     ELSE TRIM(AVWP.SW_BANK)||TRIM(AVWP.SW_CTR)||TRIM(AVWP.SW_LOC)||TRIM(AVWP.SW_BRANCH) END AVBLWITH_BANK_BIC,
RMBP.ADDRESS1 RIMB_BANK_NAME,  
CASE WHEN TRIM(RMBP.ADDRESS1) IS NOT NULL AND TRIM(RMBP.ADDRESS2) IS NULL THEN '.' ELSE RMBP.ADDRESS2 END RIMB_BANK_ADDR1,
RMBP.ADDRESS3 RIMB_BANK_ADDR2,
SUBSTR(TRIM(RMBP.ADDRESS4)||' '||TRIM(RMBP.ADDRESS5),1,45) RIMB_BANK_ADDR3, 
'' RIMB_BANK_CITY, 
'' RIMB_BANK_STATE, 
RMBP.COUNTRY RIMB_BANK_CNTRY, 
substr(TRIM(RMBP.ZIPCODE),1,10) RIMB_BANK_PINCODE, 
RMBP.SW_BANK||RMBP.SW_CTR||RMBP.SW_LOC||RMBP.SW_BRANCH RIMB_BANK_BIC,
ADVTP.ADDRESS1 ADVTHRU_BANK_NAME, 
ADVTP.ADDRESS2 ADVTHRU_BANK_ADDR1,
ADVTP.ADDRESS3 ADVTHRU_BANK_ADDR2,
SUBSTR(TRIM(ADVTP.ADDRESS4)||' '||TRIM(ADVTP.ADDRESS5),1,45) ADVTHRU_BANK_ADDR3, 
'' ADVTHRU_BANK_CITY, 
'' ADVTHRU_BANK_STATE, 
ADVTP.COUNTRY ADVTHRU_BANK_CNTRY, 
substr(TRIM(ADVTP.ZIPCODE),1,10) ADVTHRU_BANK_PINCODE, 
ADVTP.SW_BANK||ADVTP.SW_CTR||ADVTP.SW_LOC||ADVTP.SW_BRANCH ADVTHRU_BANK_BIC,
DC_B2KID
FROM MASTER_ODS M
INNER JOIN TF_ELC_MASTER ELC ON ELC.MASTER_REF=M.MASTER_REF
LEFT JOIN LCMASTER_ODS L ON M.KEY97=L.KEY97
LEFT JOIN PARTYDTLS_ODS PCPP ON PCPP.KEY97=L.APP_PTY
LEFT JOIN PARTYDTLS_ODS ISSUP ON ISSUP.KEY97=L.ISSPTY_PTY
LEFT JOIN PARTYDTLS_ODS RCVDP ON RCVDP.KEY97=L.RCVD_PTY
LEFT JOIN PARTYDTLS_ODS BENP ON BENP.KEY97=L.BEN_PTY
LEFT JOIN PARTYDTLS_ODS ADVP ON ADVP.KEY97=L.ADVBNK_PTY
LEFT JOIN PARTYDTLS_ODS AVWP ON AVWP.KEY97=L.AVWBNK_PTY
LEFT JOIN PARTYDTLS_ODS RMBP ON RMBP.KEY97=L.REIMB_PTY
LEFT JOIN PARTYDTLS_ODS THRD ON THRD.KEY97=L.THIRD_PTY
LEFT JOIN PARTYDTLS_ODS ADVTP ON ADVTP.KEY97=L.ADVTHR_PTY
LEFT JOIN PARTYDTLS_ODS THRDP ON THRDP.KEY97=L.THIRD_PTY
LEFT JOIN PARTYDTLS_ODS PRI ON PRI.KEY97=M.PCP_PTY
LEFT JOIN CAPF_ODS CA ON CA.CABRNM=CASE WHEN TRIM(M.BHALF_BRN) IS NOT NULL THEN M.BHALF_BRN ELSE M.INPUT_BRN END 
LEFT JOIN TBAADM.DCMM DC ON DC_REF_NUM=TRIM(REPLACE (M.MASTER_REF,'/','-'));

COMMIT; 

TRUNCATE TABLE TF_BILLS_ADD;

COMMIT;

INSERT INTO TF_BILLS_ADD
SELECT
REPLACE(TRIM(M.MASTER_REF),'/','-') BILL_ID,
DRWR.ADDRESS1 DRAWER_NAME,
CASE WHEN TRIM(DRWR.ADDRESS2) IS NULL THEN '.' ELSE SUBSTR(TRIM(DRWR.ADDRESS2),1,45) END DRAWER_ADDRESS1,
CASE WHEN TRIM(DRWR.ADDRESS3) IS NULL THEN '.' ELSE SUBSTR(TRIM(DRWR.ADDRESS3),1,45) END DRAWER_ADDRESS2,
SUBSTR(TRIM(TRIM(DRWR.ADDRESS4)||' '||TRIM(DRWR.ADDRESS5)),1,45) DRAWER_ADDRESS3,
' ' DRAWER_CITY,
' ' DRAWER_STATE,
DRWR.COUNTRY DRAWER_COUNTRY,
TRIM(DRWR.ZIPCODE) DRAWER_PINCODE,
DRWE.ADDRESS1 DRAWEE_NAME,
CASE WHEN TRIM(DRWE.ADDRESS2) IS NULL THEN '.' ELSE SUBSTR(TRIM(DRWE.ADDRESS2),1,45) END DRAWEE_ADDRESS1,
CASE WHEN TRIM(DRWE.ADDRESS3) IS NULL THEN '.' ELSE SUBSTR(TRIM(DRWE.ADDRESS3),1,45) END DRAWEE_ADDRESS2,
SUBSTR(TRIM(TRIM(DRWE.ADDRESS4)||' '||TRIM(DRWE.ADDRESS5)),1,45) DRAWEE_ADDRESS3,
' ' DRAWEE_CITY,
' ' DRAWEE_STATE,
DRWE.COUNTRY DRAWEE_COUNTRY,
TRIM(DRWE.ZIPCODE) DRAWEE_PINCODE,
CASE WHEN CM.NPCP_ROLE='CBK' THEN NPCP.ADDRESS1 ELSE PCP.ADDRESS1 END CBNAME, 
CASE WHEN CM.NPCP_ROLE='CBK' THEN NPCP.ADDRESS2 ELSE PCP.ADDRESS2 END CBADDRESS1, 
CASE WHEN CM.NPCP_ROLE='CBK' THEN NPCP.ADDRESS3 ELSE PCP.ADDRESS3 END CBADDRESS2, 
CASE WHEN CM.NPCP_ROLE='CBK' THEN TRIM(SUBSTR(TRIM(NPCP.ADDRESS4)||' '||TRIM(NPCP.ADDRESS5),1,45)) ELSE TRIM(SUBSTR(TRIM(PCP.ADDRESS4)||' '||TRIM(PCP.ADDRESS5),1,45)) END CBADDRESS3, 
' ' CBCITY, 
' ' CBSTATE, 
CASE WHEN CM.NPCP_ROLE='CBK' THEN NPCP.COUNTRY ELSE PCP.COUNTRY END CBCNTRYCODE, 
CASE WHEN CM.NPCP_ROLE='CBK' THEN TRIM(NPCP.ZIPCODE) ELSE TRIM(PCP.ZIPCODE) END CBPINCODE, 
CASE WHEN CM.NPCP_ROLE='CBK' THEN NPCP.SW_BANK||NPCP.SW_CTR||NPCP.SW_LOC||NPCP.SW_BRANCH ELSE PCP.SW_BANK||PCP.SW_CTR||PCP.SW_LOC||PCP.SW_BRANCH END CBBICID, 
FB.BILL_B2K_ID
FROM TIDATAITEM_ODS T
INNER JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
INNER JOIN MAP_SOL SOL ON SOL.BR_CODE=CASE WHEN TRIM(M.BHALF_BRN) IS NOT NULL THEN M.BHALF_BRN ELSE M.INPUT_BRN END 
LEFT JOIN PARTYDTLS_ODS PCP ON PCP.KEY97=M.PCP_PTY -- BANK BASED ON PCP_ROLE='RBK'
LEFT JOIN PARTYDTLS_ODS NPCP ON NPCP.KEY97=M.NPCP_PTY -- BANK BASED ON NPCP_ROLE='CBK'
LEFT JOIN PARTYDTLS_ODS DRWE ON DRWE.KEY97=CM.DRAWEE_PTY --- DRAWEE PARTY DETAILS
LEFT JOIN PARTYDTLS_ODS DRWR ON DRWR.KEY97=CM.DRAWER_PTY --- DRAWER PARTY DETAILS---applicant
LEFT JOIN TBAADM.FBM FB ON TRIM(BILL_ID)=REPLACE(TRIM(M.MASTER_REF),'/','-')
WHERE T.TYPEFLAG IN ('336','7490','2051','9389')
AND TRIM(M.STATUS)='LIV' 
AND CD.O_S_AMT!=0
AND M.REFNO_PFIX = 'OUD'
AND TRIM(CD.STATUS) NOT IN ('RT','P')
AND M.AMT_O_S !=0;

COMMIT;

INSERT INTO TF_BILLS_ADD
SELECT
REPLACE(TRIM(M.MASTER_REF),'/','-') BILL_ID,
DRWR.ADDRESS1 DRAWER_NAME,
CASE WHEN TRIM(DRWR.ADDRESS2) IS NULL THEN '.' ELSE SUBSTR(TRIM(DRWR.ADDRESS2),1,45) END DRAWER_ADDRESS1,
CASE WHEN TRIM(DRWR.ADDRESS3) IS NULL THEN '.' ELSE SUBSTR(TRIM(DRWR.ADDRESS3),1,45) END DRAWER_ADDRESS2,
SUBSTR(TRIM(TRIM(DRWR.ADDRESS4)||' '||TRIM(DRWR.ADDRESS5)),1,45) DRAWER_ADDRESS3,
'' DRAWER_CITY,
'' DRAWER_STATE,
DRWR.COUNTRY DRAWER_COUNTRY,
TRIM(DRWR.ZIPCODE) DRAWER_PINCODE,
DRWE.ADDRESS1 DRAWEE_NAME,
CASE WHEN TRIM(DRWE.ADDRESS2) IS NULL THEN '.' ELSE SUBSTR(TRIM(DRWE.ADDRESS2),1,45) END DRAWEE_ADDRESS1,
CASE WHEN TRIM(DRWE.ADDRESS3) IS NULL THEN '.' ELSE SUBSTR(TRIM(DRWE.ADDRESS3),1,45) END DRAWEE_ADDRESS2,
SUBSTR(TRIM(TRIM(DRWE.ADDRESS4)||' '||TRIM(DRWE.ADDRESS5)),1,45) DRAWEE_ADDRESS3,
'' DRAWEE_CITY,
'' DRAWEE_STATE,
DRWE.COUNTRY DRAWEE_COUNTRY,
TRIM(DRWE.ZIPCODE) DRAWEE_PINCODE,
PCP.ADDRESS1 CBNAME, 
CASE WHEN TRIM(PCP.ADDRESS2) IS NULL THEN '.' ELSE SUBSTR(TRIM(PCP.ADDRESS2),1,45) END CBADDRESS1, 
PCP.ADDRESS3 CBADDRESS2, 
TRIM(SUBSTR(TRIM(PCP.ADDRESS4)||' '||TRIM(PCP.ADDRESS5),1,45)) CBADDRESS3, 
'' CBCITY, 
'' CBSTATE, 
PCP.COUNTRY CBCNTRYCODE, 
SUBSTR(TRIM(PCP.ZIPCODE),1,10) CBPINCODE, 
PCP.SW_BANK||PCP.SW_CTR||PCP.SW_LOC||PCP.SW_BRANCH CBBICID, 
FB.BILL_B2K_ID
FROM TIDATAITEM_ODS T
LEFT JOIN COLLDRAFT_ODS CD ON T.KEY97=CD.KEY97
INNER JOIN MASTER_ODS M ON T.MASTER_KEY=M.KEY97
INNER JOIN COLLMASTER_ODS CM ON M.KEY97=CM.KEY97
LEFT JOIN PARTYDTLS_ODS PCP ON PCP.KEY97=M.PCP_PTY -- BANK
LEFT JOIN PARTYDTLS_ODS DRWE ON DRWE.KEY97=CM.DRAWEE_PTY --- DRAWEE PARTY DETAILS
LEFT JOIN PARTYDTLS_ODS DRWR ON DRWR.KEY97=CM.DRAWER_PTY --- DRAWER PARTY DETAILS---applicant
LEFT JOIN CAPF CA ON CABBN=CASE WHEN TRIM(M.BHALF_BRN) IS NOT NULL THEN M.BHALF_BRN ELSE M.INPUT_BRN END
LEFT JOIN TBAADM.FBM FB ON TRIM(BILL_ID)=REPLACE(TRIM(M.MASTER_REF),'/','-')
WHERE CD.O_S_AMT!=0 AND M.TOTLIABAMT!=0 AND M.STATUS='LIV' AND M.REFNO_PFIX IN 'COL' AND TRIM(CD.STATUS) NOT IN ('RT','P');

COMMIT;

INSERT INTO TF_BILLS_ADD
SELECT DISTINCT
SUBSTR(REPLACE((M.MASTER_REF),'/','-'),1,5)||'-'||SUBSTR(REPLACE((M.MASTER_REF),'/','-'),11,6)||'B'||LPAD(B.REFNO_SERL,3,0) BILLID,
DRWR.ADDRESS1 DRAWER_NAME,
CASE WHEN TRIM(DRWR.ADDRESS2) IS NULL THEN '.' ELSE SUBSTR(TRIM(DRWR.ADDRESS2),1,45) END DRAWER_ADDRESS1,
CASE WHEN TRIM(DRWR.ADDRESS3) IS NULL THEN '.' ELSE SUBSTR(TRIM(DRWR.ADDRESS3),1,45) END DRAWER_ADDRESS2,
SUBSTR(TRIM(TRIM(DRWR.ADDRESS4)||' '||TRIM(DRWR.ADDRESS5)),1,45) DRAWER_ADDRESS3,
' ' DRAWER_CITY,
' ' DRAWER_STATE,
DRWR.COUNTRY DRAWER_COUNTRY,
TRIM(DRWR.ZIPCODE) DRAWER_PINCODE,
DRWE.ADDRESS1 DRAWEE_NAME,
CASE WHEN TRIM(DRWE.ADDRESS2) IS NULL THEN '.' ELSE SUBSTR(TRIM(DRWE.ADDRESS2),1,45) END DRAWEE_ADDRESS1,
CASE WHEN TRIM(DRWE.ADDRESS3) IS NULL THEN '.' ELSE SUBSTR(TRIM(DRWE.ADDRESS3),1,45) END DRAWEE_ADDRESS2,
SUBSTR(TRIM(TRIM(DRWE.ADDRESS4)||' '||TRIM(DRWE.ADDRESS5)),1,45) DRAWEE_ADDRESS3,
' ' DRAWEE_CITY,
' ' DRAWEE_STATE,
DRWE.COUNTRY DRAWEE_COUNTRY,
TRIM(DRWE.ZIPCODE) DRAWEE_PINCODE,
CB.ADDRESS1 CBNAME, 
CASE WHEN TRIM(CB.ADDRESS2) IS NULL THEN '.' ELSE SUBSTR(TRIM(CB.ADDRESS2),1,45) END CBADDRESS1, 
CB.ADDRESS3 CBADDRESS2, 
TRIM(SUBSTR(TRIM(CB.ADDRESS4)||' '||TRIM(CB.ADDRESS5),1,45)) CBADDRESS3, 
'' CBCITY, 
'' CBSTATE, 
CB.COUNTRY CBCNTRYCODE, 
SUBSTR(TRIM(CB.ZIPCODE),1,10) CBPINCODE, 
CB.SW_BANK||CB.SW_CTR||CB.SW_LOC||CB.SW_BRANCH CBBICID, 
FB.BILL_B2K_ID
FROM MASTER_ODS M
INNER JOIN TF_ILC_MASTER TF ON TF.MASTER_REF=M.MASTER_REF
LEFT JOIN LCMASTER_ODS L ON M.KEY97=L.KEY97
LEFT JOIN BASEEVENT_ODS B ON B.MASTER_KEY=M.KEY97 AND B.AMOUNT!=0
LEFT JOIN PARTYDTLS_ODS DRWR ON DRWR.KEY97=L.BEN_PTY
LEFT JOIN PARTYDTLS_ODS DRWE ON DRWE.KEY97=L.APP_PTY
LEFT JOIN CAPF_ODS CA ON CA.CABRNM=M.INPUT_BRN 
LEFT JOIN PRODTYPE_ODS PR ON PR.KEY97=M.PRODTYPE
LEFT JOIN LCPAYMENT_ODS LCPAY ON LCPAY.KEY97=B.KEY97
LEFT JOIN PARTPAYMNT_ODS PARTPAY ON PARTPAY.OR_PAY_EV=B.KEY97 AND PARTPAY.PAYEV_KEY IS NULL
LEFT JOIN TIDATAITEM_ODS TIO ON B.KEY97=TIO.EVENT_KEY AND TIO.TYPEFLAG='27713'
INNER JOIN PARTYDTLS_ODS CB ON CB.KEY97=TIO.KEY97 AND LCPAY.PRSPTY_PTY=CB.ROLE
LEFT JOIN TBAADM.FBM FB ON TRIM(BILL_ID)=SUBSTR(REPLACE((M.MASTER_REF),'/','-'),1,5)||'-'||SUBSTR(REPLACE((M.MASTER_REF),'/','-'),11,6)||'B'||LPAD(B.REFNO_SERL,3,0) AND BANK_ID='01'
WHERE  B.STATUS='c'  AND TRIM(B.REFNO_PFIX) = 'CLM'
AND M.REFNO_PFIX='ILC'
AND PARTPAY.PP_STAT!='R';

COMMIT;

INSERT INTO TF_BILLS_ADD
SELECT
SUBSTR(REPLACE(TRIM(M.MASTER_REF),'/','-'),1,12)||'B'||LPAD(B.REFNO_SERL,3,0) BILLID,
DRWR.ADDRESS1 DRAWER_NAME,
CASE WHEN TRIM(DRWR.ADDRESS2) IS NULL THEN '.' ELSE SUBSTR(TRIM(DRWR.ADDRESS2),1,45) END DRAWER_ADDRESS1,
CASE WHEN TRIM(DRWR.ADDRESS3) IS NULL THEN '.' ELSE SUBSTR(TRIM(DRWR.ADDRESS3),1,45) END DRAWER_ADDRESS2,
SUBSTR(TRIM(TRIM(DRWR.ADDRESS4)||' '||TRIM(DRWR.ADDRESS5)),1,45) DRAWER_ADDRESS3,
'' DRAWER_CITY,
'' DRAWER_STATE,
DRWR.COUNTRY DRAWER_COUNTRY,
TRIM(DRWR.ZIPCODE) DRAWER_PINCODE,
DRWE.ADDRESS1 DRAWEE_NAME,
CASE WHEN TRIM(DRWE.ADDRESS2) IS NULL THEN '.' ELSE SUBSTR(TRIM(DRWE.ADDRESS2),1,45) END DRAWEE_ADDRESS1,
CASE WHEN TRIM(DRWE.ADDRESS3) IS NULL THEN '.' ELSE SUBSTR(TRIM(DRWE.ADDRESS3),1,45) END DRAWEE_ADDRESS2,
SUBSTR(TRIM(TRIM(DRWE.ADDRESS4)||' '||TRIM(DRWE.ADDRESS5)),1,45) DRAWEE_ADDRESS3,
'' DRAWEE_CITY,
'' DRAWEE_STATE,
DRWE.COUNTRY DRAWEE_COUNTRY,
TRIM(DRWE.ZIPCODE) DRAWEE_PINCODE,
--CB.ADDRESS1 CBNAME, 
--CASE WHEN TRIM(CB.ADDRESS2) IS NULL THEN '.' ELSE SUBSTR(TRIM(CB.ADDRESS2),1,45) END CBADDRESS1, 
--CB.ADDRESS3 CBADDRESS2, 
--TRIM(SUBSTR(TRIM(CB.ADDRESS4)||' '||TRIM(CB.ADDRESS5),1,45)) CBADDRESS3, 
--'' CBCITY, 
--'' CBSTATE, 
--CB.COUNTRY CBCNTRYCODE, 
--SUBSTR(TRIM(CB.ZIPCODE),1,10) CBPINCODE, 
--CB.SW_BANK||CB.SW_CTR||CB.SW_LOC||CB.SW_BRANCH CBBICID,
DC_ISSUING_NAME,DC_ISSUING_ADDRESS_1,DC_ISSUING_ADDRESS_2,DC_ISSUING_ADDRESS_3,DC_ISSUING_CITY,DC_ISSUING_STATE,DC_ISSUING_COUNTRY,DC_ISSUING_PIN_CODE,DC_ISSUE_BIC_CODE, 
FB.BILL_B2K_ID
FROM MASTER_ODS M
INNER JOIN TF005 T5 ON TRIM(T5.DC_NUM)=REPLACE(M.MASTER_REF,'/','-') AND FUNC_CODE='E'
LEFT JOIN LCMASTER_ODS L ON M.KEY97=L.KEY97
LEFT JOIN BASEEVENT_ODS B ON B.MASTER_KEY=M.KEY97 AND B.AMOUNT!=0
LEFT JOIN PARTYDTLS_ODS DRWE ON DRWE.KEY97=L.APP_PTY
LEFT JOIN PARTYDTLS_ODS DRWR ON DRWR.KEY97=L.BEN_PTY
LEFT JOIN LCPAYMENT_ODS LCPAY ON LCPAY.KEY97=B.KEY97
LEFT JOIN PARTPAYMNT_ODS PARTPAY ON PARTPAY.OR_PAY_EV=B.KEY97 AND PARTPAY.PAYEV_KEY IS NULL
LEFT JOIN TIDATAITEM_ODS TIO ON B.KEY97=TIO.EVENT_KEY AND TIO.TYPEFLAG='27713'
INNER JOIN PARTYDTLS_ODS CB ON CB.KEY97=TIO.KEY97 AND LCPAY.PRSPTY_PTY=CB.ROLE
LEFT JOIN TBAADM.FBM FB ON TRIM(BILL_ID)=SUBSTR(REPLACE(TRIM(M.MASTER_REF),'/','-'),1,12)||'B'||LPAD(B.REFNO_SERL,3,0) AND BANK_ID='01'
WHERE  B.STATUS IN ('c','w')  AND TRIM(B.REFNO_PFIX) = 'DPR'
AND M.REFNO_PFIX='ELC'
AND (PARTPAY.PP_STAT!='R' OR TRIM(PARTPAY.PP_STAT) IS NULL);

COMMIT;

 